"use strict";(self.webpackChunkhertzbeat=self.webpackChunkhertzbeat||[]).push([[5931],{15680:(e,a,t)=>{t.d(a,{xA:()=>c,yg:()=>g});var r=t(96540);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){n(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function p(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var i=r.createContext({}),s=function(e){var a=r.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},c=function(e){var a=s(e.components);return r.createElement(i.Provider,{value:a},e.children)},m={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},d=r.forwardRef((function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,i=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(t),g=n,u=d["".concat(i,".").concat(g)]||d[g]||m[g]||o;return t?r.createElement(u,l(l({ref:a},c),{},{components:t})):r.createElement(u,l({ref:a},c))}));function g(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,l=new Array(o);l[0]=d;var p={};for(var i in a)hasOwnProperty.call(a,i)&&(p[i]=a[i]);p.originalType=e,p.mdxType="string"==typeof e?e:n,l[1]=p;for(var s=2;s<o;s++)l[s]=t[s];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},29443:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>p,toc:()=>s});var r=t(58168),n=(t(96540),t(15680));const o={},l="HertzBeat \u5347\u7ea7\u6307\u5bfc-(Docker Mode)",p={permalink:"/zh-cn/blog/2025/04/23/hertzbeat-upgrade-guide-docker-mode",editUrl:"https://github.com/apache/hertzbeat/edit/master/home/i18n/zh-cn/docusaurus-plugin-content-blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md",source:"@site/i18n/zh-cn/docusaurus-plugin-content-blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md",title:"HertzBeat \u5347\u7ea7\u6307\u5bfc-(Docker Mode)",description:"Docker \u65b9\u5f0f\u5347\u7ea7 - Mysql \u6570\u636e\u5e93",date:"2025-04-23T00:00:00.000Z",formattedDate:"2025\u5e744\u670823\u65e5",tags:[],readingTime:2.365,hasTruncateMarker:!1,authors:[],frontMatter:{},prevItem:{title:"\u56e0\u70ed\u7231\u800c\u8d21\u732e\u5f00\u6e90\uff1a\u5982\u4f55\u4ece\u7528\u6237\u6210\u957f\u4e3a Apache HertzBeat\u2122 \u7684 PPMC \u6210\u5458",permalink:"/zh-cn/blog/2025/5/19/new-pmc"},nextItem:{title:"HertzBeat \u4ece 1.6.1 \u7248\u672c\u5347\u7ea7\u5230 1.7.0 \u7248\u672c\u6307\u5f15-(Helm Mode)",permalink:"/zh-cn/blog/2025/04/23/hertzbeat-upgrade-guide-from-v1.6.1-to-v1.7.0-helm-mode"}},i={authorsImageUrls:[]},s=[{value:"Docker \u65b9\u5f0f\u5347\u7ea7 - Mysql \u6570\u636e\u5e93",id:"docker-\u65b9\u5f0f\u5347\u7ea7---mysql-\u6570\u636e\u5e93",level:2}],c={toc:s};function m(e){let{components:a,...t}=e;return(0,n.yg)("wrapper",(0,r.A)({},c,t,{components:a,mdxType:"MDXLayout"}),(0,n.yg)("h2",{id:"docker-\u65b9\u5f0f\u5347\u7ea7---mysql-\u6570\u636e\u5e93"},"Docker \u65b9\u5f0f\u5347\u7ea7 - Mysql \u6570\u636e\u5e93"),(0,n.yg)("ol",null,(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u6570\u636e\u5907\u4efd"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"\u5907\u4efd\u6570\u636e\u5e93\uff0c\u5c06 mysql \u6570\u636e\u624b\u52a8\u505a\u5907\u4efd\uff0c\u6309\u9700\u5907\u4efd"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'mysqldump -h<HOST-IP> -P<PORT> -uroot -p"PASSWORD" <\u5e93\u540d> hertzbeat_backup-`date +%Y-%m-%d`.sql #\u5355\u5e93\u5907\u4efd\nmysqldump -h<HOST-IP> -P<PORT> -uroot -p"PASSWORD" > hertzbeat_backup-`date +%Y-%m-%d`.sql # \u6574\u5e93\u5907\u4efd\n'))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},"\u5907\u4efd\u914d\u7f6e\u6587\u4ef6\u53ca\u6570\u636e\u76ee\u5f55"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"mv application.yml application-bak.yml && mv sureness-bak.yml\ncp -R data data-`date +%Y-%m-%d`. bak\n"))))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u5173\u95ed \u5e76\u79fb\u9664 HertzBeat \u5bb9\u5668"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-shell"},"docker stop hertzbeat && docker rm hertzbeat\n"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u5347\u7ea7\u6570\u636e\u5e93\u811a\u672c"),(0,n.yg)("p",{parentName:"li"},"\u6253\u5f00",(0,n.yg)("a",{parentName:"p",href:"https://github.com/apache/hertzbeat/tree/master/hertzbeat-manager/src/main/resources/db/migration"},"https://github.com/apache/hertzbeat/tree/master/hertzbeat-manager/src/main/resources/db/migration"),"\uff0c \u9009\u62e9\u4f60\u4f7f\u7528\u7684\u6570\u636e\u5e93\u7684\u76ee\u5f55\u4e0b\u76f8\u5e94\u7684 ",(0,n.yg)("inlineCode",{parentName:"p"},"V160__update_column.sql"),"\u6587\u4ef6\u5728 Mysql \u6267\u884c\u5347\u7ea7 sql\u3002")),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u66f4\u6362\u955c\u50cf\u91cd\u65b0\u542f\u52a8 HertzBeat \u5bb9\u5668"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"$ docker run -d -p 1157:1157 -p 1158:1158 \\\n    -v $(pwd)/data:/opt/hertzbeat/data \\\n    -v $(pwd)/logs:/opt/hertzbeat/logs \\\n    -v $(pwd)/application.yml:/opt/hertzbeat/config/application.yml \\\n    -v $(pwd)/sureness.yml:/opt/hertzbeat/config/sureness.yml \\\n    --restart=always \\\n    --name hertzbeat apache/hertzbeat:v1.7.0\n"))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u5347\u7ea7\u914d\u7f6e\u6587\u4ef6"),(0,n.yg)("p",{parentName:"li"},"\u53c2\u8003\u5907\u4efd\u914d\u7f6e\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u57fa\u7840\u4e0a\u8fdb\u884c\u4fee\u6539\u3002"),(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"p"},"application.yml"),"\u4e00\u822c\u9700\u8981\u4fee\u6539\u4ee5\u4e0b\u90e8\u5206"),(0,n.yg)("p",{parentName:"li"},"\u9ed8\u8ba4\u4e3a\uff1a"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"datasource:\n  driver-class-name: com.mysql.cj.jdbc.Driver\n  username: root\n  password: root\n  url: jdbc:mysql://localhost:3306/hertzbeat?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai\n  hikari:\n    max-lifetime: 120000\n\njpa:\n  show-sql: false\n  database-platform: org.eclipse.persistence.platform.database.MySQLPlatform\n  database: mysql\n  properties:\n    eclipselink:\n      logging:\n        level: SEVERE\n"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("inlineCode",{parentName:"p"},"sureness.yml"),"\u4fee\u6539\u662f\u53ef\u9009\u7684\uff0c\u4e00\u822c\u5728\u4f60\u9700\u8981\u4fee\u6539\u8d26\u53f7\u5bc6\u7801\u65f6"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"# account info config\n# eg: admin has role [admin,user], password is hertzbeat\n# eg: tom has role [user], password is hertzbeat\n# eg: lili has role [guest], plain password is lili, salt is 123, salted password is 1A676730B0C7F54654B0E09184448289\naccount:\n  - appId: admin\n    credential: hertzbeat\n    role: [admin]\n  - appId: tom\n    credential: hertzbeat\n    role: [user]\n  - appId: guest\n    credential: hertzbeat\n    role: [guest]\n  - appId: lili\n    # credential = MD5(password + salt)\n    # plain password: hertzbeat\n    # attention: digest authentication does not support salted encrypted password accounts\n    credential: 94C6B34E7A199A9F9D4E1F208093B489\n    salt: 123\n    role: [user]\n"))))),(0,n.yg)("li",{parentName:"ol"},(0,n.yg)("p",{parentName:"li"},"\u6dfb\u52a0\u76f8\u5e94\u7684\u6570\u636e\u5e93\u9a71\u52a8"),(0,n.yg)("p",{parentName:"li"},"\u7531\u4e8e apache \u57fa\u91d1\u4f1a\u5bf9\u4e8e license \u5408\u89c4\u7684\u8981\u6c42\uff0cHertzBeat \u7684\u5b89\u88c5\u5305\u4e0d\u80fd\u5305\u542b mysql\uff0coracle \u7b49 gpl \u8bb8\u53ef\u7684\u4f9d\u8d56\uff0c\u9700\u8981\u7528\u6237\u81ea\u884c\u6dfb\u52a0\uff0c\u7528\u6237\u53ef\u901a\u8fc7\u4ee5\u4e0b\u94fe\u63a5\u81ea\u884c\u4e0b\u8f7d\u9a71\u52a8 jar \u653e\u5230\u672c\u5730 ",(0,n.yg)("inlineCode",{parentName:"p"},"ext-lib"),"\u76ee\u5f55\u4e0b\uff0c\u7136\u540e\u542f\u52a8\u65f6\u5c06",(0,n.yg)("inlineCode",{parentName:"p"},"ext-lib"),"\u6302\u8f7d\u5230\u5bb9\u5668\u7684 ",(0,n.yg)("inlineCode",{parentName:"p"},"/opt/hertzbeat/ext-lib"),"\u76ee\u5f55\u3002"),(0,n.yg)("p",{parentName:"li"},"mysql\uff1a",(0,n.yg)("a",{parentName:"p",href:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.18.zip"},"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip"),"\noracle\uff08\u5982\u679c\u4f60\u8981\u76d1\u63a7 oracle\uff0c\u8fd9\u4e24\u4e2a\u9a71\u52a8\u662f\u5fc5\u987b\u7684\uff09\uff1a\n",(0,n.yg)("a",{parentName:"p",href:"https://download.oracle.com/otn-pub/otn_software/jdbc/234/ojdbc8.jar"},"https://download.oracle.com/otn-pub/otn_software/jdbc/234/ojdbc8.jar"),"\n",(0,n.yg)("a",{parentName:"p",href:"https://repo.mavenlibs.com/maven/com/oracle/database/nls/orai18n/21.5.0.0/orai18n-21.5.0.0.jar?utm_source=mavenlibs.com"},"https://repo.mavenlibs.com/maven/com/oracle/database/nls/orai18n/21.5.0.0/orai18n-21.5.0.0.jar")))))}m.isMDXComponent=!0}}]);