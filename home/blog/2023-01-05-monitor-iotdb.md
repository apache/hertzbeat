---
title: ä½¿ç”¨ HertzBeat å¯¹ç‰©è”ç½‘æ•°æ®åº“ IoTDB è¿›è¡Œç›‘æ§å®è·µ    
author: tom  
author_title: tom   
author_url: https://github.com/tomsun28  
author_image_url: https://avatars.githubusercontent.com/u/24788200?s=400&v=4  
tags: [opensource, practice]
---

## ä½¿ç”¨ HertzBeat å¯¹ç‰©è”ç½‘æ•°æ®åº“ IoTDB è¿›è¡Œç›‘æ§å®è·µï¼Œ5åˆ†é’Ÿæå®šï¼

### IoTDB ä»‹ç»  

> Apache IoTDB (Internet of Things Database) æ˜¯ä¸€æ¬¾æ—¶åºæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œå¯ä»¥ä¸ºç”¨æˆ·æä¾›æ•°æ®æ”¶é›†ã€å­˜å‚¨å’Œåˆ†æç­‰æœåŠ¡ã€‚      
> IoTDBç”±äºå…¶è½»é‡çº§æ¶æ„ã€é«˜æ€§èƒ½å’Œé«˜å¯ç”¨çš„ç‰¹æ€§ï¼Œä»¥åŠä¸ Hadoop å’Œ Spark ç”Ÿæ€çš„æ— ç¼é›†æˆï¼Œæ»¡è¶³äº†å·¥ä¸š IoT é¢†åŸŸä¸­æµ·é‡æ•°æ®å­˜å‚¨ã€é«˜ååé‡æ•°æ®å†™å…¥å’Œå¤æ‚æ•°æ®æŸ¥è¯¢åˆ†æçš„éœ€æ±‚ã€‚   

### HertzBeat ä»‹ç»  

> HertzBeat æ˜¯ä¸€æ¬¾å¼€æºï¼Œæ˜“ç”¨å‹å¥½çš„å®æ—¶ç›‘æ§ç³»ç»Ÿï¼Œæ— éœ€Agentï¼Œæ‹¥æœ‰å¼ºå¤§è‡ªå®šä¹‰ç›‘æ§èƒ½åŠ›ã€‚    
> æ”¯æŒå¯¹åº”ç”¨æœåŠ¡ï¼Œæ•°æ®åº“ï¼Œæ“ä½œç³»ç»Ÿï¼Œä¸­é—´ä»¶ï¼Œäº‘åŸç”Ÿç­‰ç›‘æ§ï¼Œé˜ˆå€¼å‘Šè­¦ï¼Œå‘Šè­¦é€šçŸ¥(é‚®ä»¶å¾®ä¿¡é’‰é’‰é£ä¹¦)ã€‚   
> HertzBeat çš„å¼ºå¤§è‡ªå®šä¹‰ï¼Œå¤šç±»å‹æ”¯æŒï¼Œæ˜“æ‰©å±•ï¼Œä½è€¦åˆï¼Œå¸Œæœ›èƒ½å¸®åŠ©å¼€å‘è€…å’Œä¸­å°å›¢é˜Ÿå¿«é€Ÿæ­å»ºè‡ªæœ‰ç›‘æ§ç³»ç»Ÿã€‚     

### åœ¨ HertzBeat 5åˆ†é’Ÿæå®šç›‘æ§ IoTDB   

#### æ“ä½œå‰æï¼Œæ‚¨å·²æ‹¥æœ‰ IoTDB ç¯å¢ƒå’Œ HertzBeat ç¯å¢ƒã€‚  

- IoTDB [éƒ¨ç½²å®‰è£…æ–‡æ¡£](https://iotdb.apache.org/UserGuide/V0.13.x/QuickStart/QuickStart.html)  
- HertzBeat [éƒ¨ç½²å®‰è£…æ–‡æ¡£](https://hertzbeat.com/docs/start/docker-deploy)  

#### ä¸€. åœ¨ IoTDB ç«¯å¼€å¯`metrics`åŠŸèƒ½ï¼Œå®ƒå°†æä¾› prometheus metrics å½¢å¼çš„æ¥å£æ•°æ®ã€‚

1. metric é‡‡é›†é»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦å…ˆåˆ° `conf/iotdb-metric.yml` ä¸­ä¿®æ”¹å‚æ•°æ‰“å¼€åé‡å¯ server  
```
# æ˜¯å¦å¯åŠ¨ç›‘æ§æ¨¡å—ï¼Œé»˜è®¤ä¸ºfalse
enableMetric: true

# æ•°æ®æä¾›æ–¹å¼ï¼Œå¯¹å¤–éƒ¨é€šè¿‡jmxå’Œprometheusåè®®æä¾›metricsçš„æ•°æ®, å¯é€‰å‚æ•°ï¼š[JMX, PROMETHEUS, IOTDB],IOTDBæ˜¯é»˜è®¤å…³é—­çš„ã€‚
metricReporterList:
  - JMX
  - PROMETHEUS
```

2. é‡å¯ IoTDB, æ‰“å¼€æµè§ˆå™¨æˆ–è€…ç”¨curl è®¿é—® http://ip:9091/metrics, å°±èƒ½çœ‹åˆ°metricæ•°æ®äº†ã€‚ 

#### äºŒ. åœ¨ HertzBeat ç›‘æ§é¡µé¢æ·»åŠ  IoTDB ç›‘æ§   

1. ç‚¹å‡»æ–°å¢IoTDBç›‘æ§  

è·¯å¾„ï¼šèœå• -> æ•°æ®åº“ç›‘æ§ -> IoTDBç›‘æ§ -> æ–°å¢IoTDBç›‘æ§  

![hertzbeat](/img/blog/monitor-iotdb-1.png)   

2. é…ç½®ç›‘æ§IoTDBæ‰€éœ€å‚æ•°   

åœ¨ç›‘æ§é¡µé¢å¡«å†™ IoTDB **æœåŠ¡IP**ï¼Œ**ç›‘æ§ç«¯å£**(é»˜è®¤9091)ï¼Œæœ€åç‚¹å‡»ç¡®å®šæ·»åŠ å³å¯ã€‚   
å…¶ä»–å‚æ•°å¦‚**é‡‡é›†é—´éš”**ï¼Œ**è¶…æ—¶æ—¶é—´**ç­‰å¯ä»¥å‚è€ƒ[å¸®åŠ©æ–‡æ¡£](https://hertzbeat.com/docs/help/iotdb/) https://hertzbeat.com/docs/help/iotdb/   

![hertzbeat](/img/blog/monitor-iotdb-2.png)    

3. å®Œæˆâœ…,ç°åœ¨æˆ‘ä»¬å·²ç»æ·»åŠ å¥½å¯¹ IoTDB çš„ç›‘æ§äº†ï¼ŒæŸ¥çœ‹ç›‘æ§åˆ—è¡¨å³å¯çœ‹åˆ°æˆ‘ä»¬çš„æ·»åŠ é¡¹ã€‚  

![hertzbeat](/img/blog/monitor-iotdb-3.png)  

4. ç‚¹å‡»ç›‘æ§åˆ—è¡¨é¡¹çš„**æ“ä½œ**->**ç›‘æ§è¯¦æƒ…å›¾æ ‡** å³å¯æµè§ˆ IoTDBçš„å®æ—¶ç›‘æ§æŒ‡æ ‡æ•°æ®ã€‚  

![hertzbeat](/img/blog/monitor-iotdb-4.png)  

5. ç‚¹å‡»**ç›‘æ§å†å²è¯¦æƒ…TAB** å³å¯æµè§ˆ IoTDBçš„å†å²ç›‘æ§æŒ‡æ ‡æ•°æ®å›¾è¡¨ğŸ“ˆã€‚  

![hertzbeat](/img/blog/monitor-iotdb-5.png)    

**å®ŒæˆDONEï¼é€šè¿‡ä¸Šé¢å‡ æ­¥ï¼Œæ€»ç»“èµ·æ¥å…¶å®ä¹Ÿå°±æ˜¯ä¸¤æ­¥**  
- **ä¸€æ­¥å¼€å¯ IoTDB ç«¯`metrics`åŠŸèƒ½**   
- **å¦ä¸€æ­¥åœ¨ HertzBeat ç›‘æ§é¡µé¢é…ç½®IPç«¯å£æ·»åŠ ç›‘æ§å³å¯**         


**è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†å¯¹ IoTDB çš„ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥éšæ—¶æŸ¥çœ‹ç›‘æ§è¯¦æƒ…æŒ‡æ ‡ä¿¡æ¯æ¥è§‚æµ‹å…¶æœåŠ¡çŠ¶æ€ï¼Œä½†äººä¸å¯èƒ½æ˜¯ä¸€ç›´å»çœ‹ï¼Œæ€»æœ‰è¦ä¼‘æ¯çš„æ—¶å€™ï¼Œç›‘æ§å¾€å¾€ä¼´éšç€å‘Šè­¦ï¼Œå½“ç›‘æ§æŒ‡æ ‡å‘ç”Ÿå¼‚å¸¸ï¼Œç›‘æ§ç³»ç»Ÿéœ€è¦èƒ½åŠæ—¶é€šçŸ¥åˆ°è´Ÿè´£äºº**  

**æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥ä¸€æ­¥ä¸€æ­¥æ•™æ‚¨é…ç½® HertzBeat ç³»ç»Ÿé‡Œçš„é˜ˆå€¼å‘Šè­¦é€šçŸ¥**     

#### ä¸‰. åœ¨ HertzBeat ç³»ç»Ÿæ·»åŠ  IoTDB æŒ‡æ ‡é˜ˆå€¼å‘Šè­¦   

1. å¯¹æŸä¸ªé‡è¦æŒ‡æ ‡é…ç½®é˜ˆå€¼å‘Šè­¦  

è·¯å¾„ï¼šèœå• -> å‘Šè­¦é˜ˆå€¼ -> æ–°å¢é˜ˆå€¼  

- é€‰æ‹©é…ç½®çš„æŒ‡æ ‡å¯¹è±¡ï¼ŒIotDBç›‘æ§æœ‰éå¸¸å¤šçš„æŒ‡æ ‡ï¼Œå…¶ä¸­æœ‰ä¸ªæŒ‡æ ‡å…³ç³»åˆ°èŠ‚ç‚¹çš„çŠ¶æ€ `cluster_node_status` -> `status` (èŠ‚ç‚¹çŠ¶æ€ï¼Œ1=online 2=offline)ã€‚   
- è¿™é‡Œæˆ‘ä»¬å°±é…ç½®å½“æ­¤æŒ‡æ ‡ `status==2` æ—¶å‘å‡ºå‘Šè­¦ï¼Œå‘Šè­¦çº§åˆ«ä¸º**ç´§æ€¥å‘Šè­¦**ï¼Œä¸€æ¬¡å³è§¦å‘ï¼Œå…·ä½“å¦‚ä¸‹å›¾ã€‚  

![hertzbeat](/img/blog/monitor-iotdb-6.png)    


2. æ–°å¢æ¶ˆæ¯é€šçŸ¥æ¥æ”¶äºº  

è·¯å¾„ï¼šèœå• -> å‘Šè­¦é€šçŸ¥ -> å‘Šè­¦æ¥æ”¶äºº -> æ–°å¢æ¥æ”¶äºº  

æ¶ˆæ¯é€šçŸ¥æ–¹å¼æ”¯æŒ **é‚®ä»¶ï¼Œé’‰é’‰ï¼Œä¼ä¸šå¾®ä¿¡ï¼Œé£ä¹¦ï¼ŒWebHookï¼ŒçŸ­ä¿¡**ç­‰ï¼Œæˆ‘ä»¬è¿™é‡Œä»¥å¸¸ç”¨çš„é’‰é’‰ä¸ºä¾‹ã€‚  

- å‚ç…§æ­¤[å¸®åŠ©æ–‡æ¡£](https://hertzbeat.com/docs/help/alert_dingtalk) https://hertzbeat.com/docs/help/alert_dingtalk åœ¨é’‰é’‰ç«¯é…ç½®æœºå™¨äººï¼Œè®¾ç½®å®‰å…¨è‡ªå®šä¹‰å…³é”®è¯`HertzBeat`ï¼Œè·å–å¯¹åº”`access_token`å€¼ã€‚ 
- åœ¨ HertzBeat é…ç½®æ¥æ”¶äººå‚æ•°å¦‚ä¸‹ã€‚  

ã€å‘Šè­¦é€šçŸ¥ã€‘->ã€æ–°å¢æ¥æ”¶äººã€‘ ->ã€é€‰æ‹©é’‰é’‰æœºå™¨äººé€šçŸ¥æ–¹å¼ã€‘->ã€è®¾ç½®é’‰é’‰æœºå™¨äººACCESS_TOKENã€‘-> ã€ç¡®å®šã€‘

![hertzbeat](/img/blog/alert-notice-1.png)    

3. é…ç½®å…³è”çš„å‘Šè­¦é€šçŸ¥ç­–ç•¥âš ï¸ ã€æ–°å¢é€šçŸ¥ç­–ç•¥ã€‘-> ã€å°†åˆšè®¾ç½®çš„æ¥æ”¶äººå…³è”ã€‘-> ã€ç¡®å®šã€‘ 

![hertzbeat](/img/blog/alert-notice-2.png)    


### å®Œæ¯•ï¼Œç°åœ¨åç­‰å‘Šè­¦æ¶ˆæ¯è¿‡æ¥äº†ã€‚å®å®å®å® 

```
[HertzBeatå‘Šè­¦é€šçŸ¥]
å‘Šè­¦ç›®æ ‡å¯¹è±¡ : iotdb.cluster_node_status.status
æ‰€å±ç›‘æ§ID : 205540620349696
æ‰€å±ç›‘æ§åç§° : IOTDB_localhost
å‘Šè­¦çº§åˆ« : ç´§æ€¥å‘Šè­¦
å‘Šè­¦è§¦å‘æ—¶é—´ : 2023-01-05 22:17:06
å†…å®¹è¯¦æƒ… : ç›‘æ§åˆ° IOTDB èŠ‚ç‚¹ 127.0.0.1 çŠ¶æ€ OFFLINE, è¯·åŠæ—¶å¤„ç†ã€‚
```

## å°ç»“   

è¿™ç¯‡å®è·µæ–‡ç« å¸¦æˆ‘ä»¬ä½“éªŒäº†å¦‚æœä½¿ç”¨ HertzBeat ç›‘æ§ IoTDB æ•°æ®åº“æŒ‡æ ‡æ•°æ®ï¼Œå¯ä»¥å‘ç°å°† ç›‘æ§-å‘Šè­¦-é€šçŸ¥ é›†ä¸€ä½“çš„ HertzBeat åœ¨æ“ä½œä¸ä½¿ç”¨æ–¹é¢æ›´åŠ çš„ä¾¿æ·ï¼Œåœ¨é¡µé¢ä¸Šç®€å•ç‚¹ä¸€ç‚¹å°±èƒ½æŠŠ IoTDB çº³å…¥ç›‘æ§ï¼Œå†ä¹Ÿä¸éœ€è¦éƒ¨ç½²å¤šä¸ªç»„ä»¶ï¼Œå†™å¤šä¸ªæœ‰é—¨æ§›çš„YMLé…ç½®æ–‡ä»¶äº†ã€‚  

IoTDB Github: https://github.com/apache/iotdb    
HertzBeat Github: https://github.com/dromara/hertzbeat 

**æ¬¢è¿äº†è§£ä½¿ç”¨Staræ”¯æŒå“¦ï¼**

åªéœ€è¦ä¸€æ¡dockerå‘½ä»¤å³å¯å®‰è£…ä½“éªŒheartbeat ï¼š   
`docker run -d -p 1157:1157 --name hertzbeat tancloud/hertzbeat`

æ³¨æ„âš ï¸HertzBeat v1.2.3 ç‰ˆæœ¬æ”¯æŒ IoTDB v0.12 v0.13, ç”±äºå…¶v1.0åˆšå‘å¸ƒ, æš‚æœªå¯¹æ­¤ç‰ˆæœ¬å…¨éƒ¨æŒ‡æ ‡å…¼å®¹ã€‚   
