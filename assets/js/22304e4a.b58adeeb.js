"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[70966],{30752:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"start/tdengine-init","title":"Use Time Series Database TDengine to Store Metrics Data (Optional)","description":"Apache HertzBeat\'s historical data storage relies on the time series database, you can choose one of them to install and initialize, or not to install (note \u26a0\ufe0f but it is strongly recommended to configure in the production environment)","source":"@site/docs/start/tdengine-init.md","sourceDirName":"start","slug":"/start/tdengine-init","permalink":"/docs/next/start/tdengine-init","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/docs/start/tdengine-init.md","tags":[],"version":"current","frontMatter":{"id":"tdengine-init","title":"Use Time Series Database TDengine to Store Metrics Data (Optional)","sidebar_label":"Metrics Store TDengine"}}');var i=t(86070),s=t(45906);const o={id:"tdengine-init",title:"Use Time Series Database TDengine to Store Metrics Data (Optional)",sidebar_label:"Metrics Store TDengine"},r=void 0,c={},l=[{value:"Install TDengine via Docker",id:"install-tdengine-via-docker",level:3},{value:"Create database instance",id:"create-database-instance",level:3},{value:"Configure the database connection in hertzbeat <code>application.yml</code> configuration file",id:"configure-the-database-connection-in-hertzbeat-applicationyml-configuration-file",level:3},{value:"FAQ",id:"faq",level:3}];function d(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Apache HertzBeat's historical data storage relies on the time series database, you can choose one of them to install and initialize, or not to install (note \u26a0\ufe0f but it is strongly recommended to configure in the production environment)"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"It is recommended to use VictoriaMetrics as metrics storage."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"TDengine is an open-source IoT time-series database, which we use to store the collected historical data of monitoring metrics. Pay attention to support \u26a0\ufe0f 3.x version."}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Note\u26a0\ufe0f Time series database is optional, but production environment configuration is strongly recommended to provide more complete historical chart functions and high performance"}),"\n",(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f If you do not configure a time series database, only the last hour of historical data is retained."}),"\nNote\u26a0\ufe0f Need TDengine 3.x Version."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"If you have TDengine environment, can directly skip to create a database instance."}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"install-tdengine-via-docker",children:"Install TDengine via Docker"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Download and install Docker environment\nDocker tools download refer to ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker official document"}),".\nAfter the installation you can check if the Docker version normally output at the terminal."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ docker -v\nDocker version 20.10.12, build e91ed57\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Install TDengine with Docker"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"$ docker run -d -p 6030-6049:6030-6049 -p 6030-6049:6030-6049/udp \\\n-v /opt/taosdata:/var/lib/taos \\ \n--name tdengine -e TZ=Asia/Shanghai \\\ntdengine/tdengine:3.0.4.0\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"-v /opt/taosdata:/var/lib/taos"})," is local persistent mount of TDengine data directory. ",(0,i.jsx)(n.code,{children:"/opt/taosdata"})," should be replaced with the actual local directory.\n",(0,i.jsx)(n.code,{children:'-e TZ="Asia/Shanghai"'})," can set time zone for TDengine.Set up the corresponding time zone you want.\nuse",(0,i.jsx)(n.code,{children:"$ docker ps"})," to check if the database started successfully"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"create-database-instance",children:"Create database instance"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Enter database Docker container"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"docker exec -it tdengine /bin/bash\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Create database named hertzbeat\nAfter entering the container\uff0cexecute ",(0,i.jsx)(n.code,{children:"taos"})," command as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"root@tdengine-server:~/TDengine-server# taos\nWelcome to the TDengine shell from Linux, Client Version\nCopyright (c) 2020 by TAOS Data, Inc. All rights reserved.\ntaos>\n"})}),"\n",(0,i.jsx)(n.p,{children:"execute commands to create database"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"taos> show databases;\ntaos> CREATE DATABASE hertzbeat KEEP 90 DURATION 10 BUFFER 16;\n"})}),"\n",(0,i.jsx)(n.p,{children:"The above statements will create a database named hertzbeat. The data will be saved for 90 days (more than 90 days data will be automatically deleted).\nA data file every 10 days, memory blocks buffer is 16MB."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check if hertzbeat database has been created success"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"taos> show databases;\ntaos> use hertzbeat;\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note\u26a0\ufe0fIf you install TDengine using package"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["In addition to start the server\uff0cyou must execute ",(0,i.jsx)(n.code,{children:"systemctl start taosadapter"})," to start adapter"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"configure-the-database-connection-in-hertzbeat-applicationyml-configuration-file",children:["Configure the database connection in hertzbeat ",(0,i.jsx)(n.code,{children:"application.yml"})," configuration file"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Configure HertzBeat's configuration file\nModify ",(0,i.jsx)(n.code,{children:"hertzbeat/config/application.yml"})," configuration file\nNote\u26a0\ufe0fThe docker container way need to mount application.yml file locally,while you can use installation package way to unzip and modify ",(0,i.jsx)(n.code,{children:"hertzbeat/config/application.yml"}),"\nReplace ",(0,i.jsx)(n.code,{children:"warehouse.store.td-engine"})," data source parameters, URL account and password."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"warehouse:\n   store:\n      # disable jpa\n      jpa:\n         enabled: false\n      # enable td-engine   \n      td-engine:\n         enabled: true\n         driver-class-name: com.taosdata.jdbc.rs.RestfulDriver\n         url: jdbc:TAOS-RS://localhost:6041/hertzbeat\n         username: root\n         password: taosdata\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Restart HertzBeat"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"faq",children:"FAQ"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Do both the time series databases IoTDB and TDengine need to be configured? Can they both be used?"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"You don't need to configure all of them, you can choose one of them. Use the enable parameter to control whether it is used or not. You can also install and configure neither, which only affects the historical chart data."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The historical chart of the monitoring page is not displayed, and pops up [Unable to provide historical chart data, please configure to rely on the time series database]"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"As shown in the pop-up window, the premise of displaying the history chart is to install and configure the dependent services of hertzbeat - IotDB database or TDengine database"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The historical picture of monitoring details is not displayed or has no data, and TDengine has been deployed"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Please confirm whether the installed TDengine version is 3.x, version 2.x are not compatible."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"The TDengine database is installed and configured, but the page still displays a pop-up [Unable to provide historical chart data, please configure the dependent time series database]"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Please check if the configuration parameters are correct",(0,i.jsx)(n.br,{}),"\n","Is td-engine enable set to true",(0,i.jsx)(n.br,{}),"\n","Note\u26a0\ufe0fIf both hertzbeat and TDengine are started under the same host for docker containers, 127.0.0.1 cannot be used for communication between containers by default, and the host IP is changed",(0,i.jsx)(n.br,{}),"\n","You can check the startup logs according to the logs directory"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},45906:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var a=t(30758);const i={},s=a.createContext(i);function o(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);