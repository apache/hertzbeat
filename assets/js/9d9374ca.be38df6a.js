"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[89473],{33625:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>s,frontMatter:()=>r,metadata:()=>p,toc:()=>g});var a=n(44320),i=(n(37953),n(58860));const r={id:"plugin",title:"Custom plugin(Beta)",sidebar_label:"Custom plugin(Beta)"},l=void 0,p={unversionedId:"help/plugin",id:"help/plugin",title:"Custom plugin(Beta)",description:"Introduction",source:"@site/docs/help/plugin.md",sourceDirName:"help",slug:"/help/plugin",permalink:"/docs/help/plugin",draft:!1,editUrl:"https://github.com/apache/hertzbeat/edit/master/home/docs/help/plugin.md",tags:[],version:"current",frontMatter:{id:"plugin",title:"Custom plugin(Beta)",sidebar_label:"Custom plugin(Beta)"},sidebar:"docs",previous:{title:"Customized bulletins",permalink:"/docs/help/bulletin"},next:{title:"Time Expression",permalink:"/docs/help/time_expression"}},o={},g=[{value:"Introduction",id:"introduction",level:3},{value:"Supported Plugin Types",id:"supported-plugin-types",level:3},{value:"Development Steps (Example: Implementing a Post-Alert Plugin)",id:"development-steps-example-implementing-a-post-alert-plugin",level:3},{value:"Defining Plugin Parameters",id:"defining-plugin-parameters",level:3}],m={toc:g},u="wrapper";function s({components:e,...t}){return(0,i.yg)(u,(0,a.A)({},m,t,{components:e,mdxType:"MDXLayout"}),(0,i.yg)("h3",{id:"introduction"},"Introduction"),(0,i.yg)("p",null,"In the current usage of ",(0,i.yg)("inlineCode",{parentName:"p"},"HertzBeat"),", interaction with external systems only occurs after an alert through the notification feature. The plugin functionality allows users to add custom operations at various stages of the ",(0,i.yg)("inlineCode",{parentName:"p"},"HertzBeat")," lifecycle, such as executing ",(0,i.yg)("inlineCode",{parentName:"p"},"SQL")," or ",(0,i.yg)("inlineCode",{parentName:"p"},"shell")," scripts after an alert, or sending collected monitoring data to other systems. Users can develop plugins following the custom plugin development process, package them, and then upload and enable them using the ",(0,i.yg)("inlineCode",{parentName:"p"},"Plugin Management")," - ",(0,i.yg)("inlineCode",{parentName:"p"},"Upload Plugin")," feature, thereby adding custom functionality without restarting ",(0,i.yg)("inlineCode",{parentName:"p"},"HertzBeat"),"."),(0,i.yg)("admonition",{type:"warning"},(0,i.yg)("p",{parentName:"admonition"},"In the current version, custom plugins are a test feature and may have some limitations and instability. The plugin functionality might be restructured in future versions.")),(0,i.yg)("h3",{id:"supported-plugin-types"},"Supported Plugin Types"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("inlineCode",{parentName:"li"},"Post-Alert")," Plugin",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Purpose: Execute custom operations after an alert"),(0,i.yg)("li",{parentName:"ul"},"Implementing Interface: ",(0,i.yg)("inlineCode",{parentName:"li"},"org.apache.hertzbeat.plugin.PostAlertPlugin")))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("inlineCode",{parentName:"li"},"Post-Collect")," Plugin",(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},"Purpose: Execute custom operations after data collection"),(0,i.yg)("li",{parentName:"ul"},"Implementing Interface: ",(0,i.yg)("inlineCode",{parentName:"li"},"org.apache.hertzbeat.plugin.PostCollectPlugin"))))),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"To ensure that plugin functionality is clear and easy to manage, we recommend and only support one implementation of one plugin type interface in a plugin.")),(0,i.yg)("p",null,"If you want to set trigger methods during collection, program startup, etc., please submit a ",(0,i.yg)("inlineCode",{parentName:"p"},"Task")," at ",(0,i.yg)("inlineCode",{parentName:"p"},"https://github.com/apache/hertzbeat/issues/new/choose"),"."),(0,i.yg)("h3",{id:"development-steps-example-implementing-a-post-alert-plugin"},"Development Steps (Example: Implementing a Post-Alert Plugin)"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Clone the main branch code ",(0,i.yg)("inlineCode",{parentName:"p"},"git clone https://github.com/apache/hertzbeat.git"),", and locate the ",(0,i.yg)("inlineCode",{parentName:"p"},"Plugin")," interface in the ",(0,i.yg)("inlineCode",{parentName:"p"},"plugin")," module.\n",(0,i.yg)("img",{alt:"plugin-1.png",src:n(52219).A,width:"1414",height:"802"}))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"In the ",(0,i.yg)("inlineCode",{parentName:"p"},"org.apache.hertzbeat.plugin.impl")," directory (create it if it does not exist), create an implementation class of ",(0,i.yg)("inlineCode",{parentName:"p"},"org.apache.hertzbeat.plugin.PostAlertPlugin"),", such as ",(0,i.yg)("inlineCode",{parentName:"p"},"org.apache.hertzbeat.plugin.impl.DemoPlugin"),". In the implementation class, receive the ",(0,i.yg)("inlineCode",{parentName:"p"},"Alert")," class as a parameter, implement the ",(0,i.yg)("inlineCode",{parentName:"p"},"execute")," method, and define custom logic. Here, we simply print the object."),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-java"},'  package org.apache.hertzbeat.plugin.impl;\n  \n  import org.apache.hertzbeat.common.entity.alerter.Alert;\n  import org.apache.hertzbeat.common.entity.plugin.PluginContext;\n  import org.apache.hertzbeat.plugin.PostAlertPlugin;\n  import org.slf4j.Logger;\n  import org.slf4j.LoggerFactory;\n  \n  public class DemoPlugin implements PostAlertPlugin {\n  \n      private static final Logger log = LoggerFactory.getLogger(DemoPlugin.class);\n  \n      @Override\n      public void execute(Alert alert, PluginContext pluginContext) {\n          log.info("DemoPlugin alert: {}", alert);\n          log.info("DemoPlugin pluginContext: {}", pluginContext);\n      }\n  }\n'))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Add the fully qualified name of the implementation class to the ",(0,i.yg)("inlineCode",{parentName:"p"},"META-INF/services/org.apache.hertzbeat.plugin.PostAlertPlugin")," file (create it if it does not exist). Each fully qualified name should be on a separate line."),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"org.apache.hertzbeat.plugin.impl.DemoPluginImpl\n"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Package the ",(0,i.yg)("inlineCode",{parentName:"p"},"hertzbeat-plugin")," module."),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-shell"},"cd plugin\nmvn package\n"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use the ",(0,i.yg)("inlineCode",{parentName:"p"},"Plugin Management")," - ",(0,i.yg)("inlineCode",{parentName:"p"},"Upload Plugin")," feature to upload the plugin package ending with ",(0,i.yg)("inlineCode",{parentName:"p"},"-jar-with-lib.jar"),", and enable the plugin to execute custom operations after an alert."))),(0,i.yg)("h3",{id:"defining-plugin-parameters"},"Defining Plugin Parameters"),(0,i.yg)("p",null,"The plugin feature supports custom parameters, and you can fill in the required parameters for the plugin during runtime using the ",(0,i.yg)("inlineCode",{parentName:"p"},"Plugin Management")," - ",(0,i.yg)("inlineCode",{parentName:"p"},"Edit Parameters")," feature.\nBelow is an example of defining a plugin with two parameters, detailing the process of defining plugin parameters:"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Add a parameter definition file in the ",(0,i.yg)("inlineCode",{parentName:"p"},"define")," directory. Note that the parameter definition file must be a YAML file starting with ",(0,i.yg)("inlineCode",{parentName:"p"},"define"),", such as ",(0,i.yg)("inlineCode",{parentName:"p"},"define-demo.yml"),".")),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Define parameters in ",(0,i.yg)("inlineCode",{parentName:"p"},"define-demo.yml")," as shown below:"),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-yaml"},"params:\n - field: host\n   # name-param field display i18n name\n   name:\n     zh-CN: \u76ee\u6807 Host\n     en-US: Target Host\n   # type-param field type(most mapping the html input type)\n   type: text\n   # required-true or false\n   required: true\n # field-param field key\n - field: port\n   # name-param field display i18n name\n   name:\n     zh-CN: \u7aef\u53e3\n     en-US: Port\n   # type-param field type(most mapping the html input type)\n   type: number\n   # when type is number, range is required\n   range: '[0,65535]'\n"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Use the parameters in the plugin logic"),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-java"},' @Override\n public void execute(Alert alert, PluginContext pluginContext) {\n     log.info("param host:{}",pluginContext.getString("host"));\n     log.info("param port:{}",pluginContext.getInteger("port"));\n }\n')))))}s.isMDXComponent=!0},52219:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/plugin-1-2895d6c2b5cdb1e30f2dfae90ee2ae27.png"},58860:(e,t,n)=>{n.d(t,{xA:()=>m,yg:()=>d});var a=n(37953);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){i(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var o=a.createContext({}),g=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=g(e.components);return a.createElement(o.Provider,{value:t},e.children)},u="mdxType",s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef(function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,o=e.parentName,m=p(e,["components","mdxType","originalType","parentName"]),u=g(n),c=i,d=u["".concat(o,".").concat(c)]||u[c]||s[c]||r;return n?a.createElement(d,l(l({ref:t},m),{},{components:n})):a.createElement(d,l({ref:t},m))});function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=c;var p={};for(var o in t)hasOwnProperty.call(t,o)&&(p[o]=t[o]);p.originalType=e,p[u]="string"==typeof e?e:i,l[1]=p;for(var g=2;g<r;g++)l[g]=n[g];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"}}]);