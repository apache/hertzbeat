"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[21038],{45906:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>l});var s=t(30758);const i={},r=s.createContext(i);function d(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(r.Provider,{value:n},e.children)}},75118:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>a,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"help/nginx","title":"Monitoring Nginx","description":"Collect and monitor the general performance Metrics of Nginx.","source":"@site/versioned_docs/version-1.7.x/help/nginx.md","sourceDirName":"help","slug":"/help/nginx","permalink":"/docs/1.7.x/help/nginx","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-1.7.x/help/nginx.md","tags":[],"version":"1.7.x","frontMatter":{"id":"nginx","title":"Monitoring Nginx","sidebar_label":"Nginx Monitor","keywords":["open source monitoring tool","open source java monitoring tool","monitoring nginx metrics"]},"sidebar":"docs","previous":{"title":"SSL Monitor","permalink":"/docs/1.7.x/help/ssl_cert"},"next":{"title":"mailbox Monitor","permalink":"/docs/1.7.x/help/imap"}}');var i=t(86070),r=t(45906);const d={id:"nginx",title:"Monitoring Nginx",sidebar_label:"Nginx Monitor",keywords:["open source monitoring tool","open source java monitoring tool","monitoring nginx metrics"]},l=void 0,o={},c=[{value:"Need Enable <code>ngx_http_stub_status_module</code> And <code>ngx_http_reqstat_module</code> Module",id:"need-enable-ngx_http_stub_status_module-and-ngx_http_reqstat_module-module",level:3},{value:"Enable <code>ngx_http_stub_status_module</code>",id:"enable-ngx_http_stub_status_module",level:3},{value:"Enable <code>ngx_http_reqstat_module</code>",id:"enable-ngx_http_reqstat_module",level:3},{value:"Configuration parameter",id:"configuration-parameter",level:3},{value:"Collection Metrics",id:"collection-metrics",level:3},{value:"Metrics Set\uff1anginx_status",id:"metrics-setnginx_status",level:4},{value:"Metrics Set\uff1areq_status",id:"metrics-setreq_status",level:4}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Collect and monitor the general performance Metrics of Nginx."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Protocol Use\uff1aNginx"})}),"\n",(0,i.jsxs)(n.h3,{id:"need-enable-ngx_http_stub_status_module-and-ngx_http_reqstat_module-module",children:["Need Enable ",(0,i.jsx)(n.code,{children:"ngx_http_stub_status_module"})," And ",(0,i.jsx)(n.code,{children:"ngx_http_reqstat_module"})," Module"]}),"\n",(0,i.jsx)(n.p,{children:"If you want to monitor information in 'Nginx' with this monitoring type, you need to modify your nginx configure file for enable the module monitor."}),"\n",(0,i.jsxs)(n.h3,{id:"enable-ngx_http_stub_status_module",children:["Enable ",(0,i.jsx)(n.code,{children:"ngx_http_stub_status_module"})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Check if ",(0,i.jsx)(n.code,{children:"ngx_http_stub_status_module"})," has been added"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"nginx -V\n"})}),"\n",(0,i.jsxs)(n.p,{children:["View whether it contains ",(0,i.jsx)(n.code,{children:"--with-http_stub_status_module"}),", if not, you need to recompile and install Nginx."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Compile and install Nginx, add ",(0,i.jsx)(n.code,{children:"ngx_http_stub_status_module"})," module"]}),"\n",(0,i.jsx)(n.p,{children:"Download Nginx and unzip it, execute the following command in the directory"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\n./configure --prefix=/usr/local/nginx --with-http_stub_status_module\n\nmake && make install\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Modify Nginx configure file"}),"\n",(0,i.jsxs)(n.p,{children:["Modify the ",(0,i.jsx)(n.code,{children:"nginx.conf"})," file and add the monitoring module exposed endpoint, as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# modify nginx.conf\nserver {\n        listen 80; # port\n        server_name localhost;\n        location /nginx-status {\n                stub_status     on;\n                access_log      on;\n                #allow 127.0.0.1; #only allow requests from localhost\n              #deny all;  #deny all other hosts\n        }\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Reload Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\nnginx -s reload\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Access ",(0,i.jsx)(n.code,{children:"http://localhost/nginx-status"})," in the browser to view the Nginx monitoring status information."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"enable-ngx_http_reqstat_module",children:["Enable ",(0,i.jsx)(n.code,{children:"ngx_http_reqstat_module"})]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Install ",(0,i.jsx)(n.code,{children:"ngx_http_reqstat_module"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:" # install `ngx_http_reqstat_module`\n wget https://github.com/zls0424/ngx_req_status/archive/master.zip -O ngx_req_status.zip\n \n unzip ngx_req_status.zip\n \n patch -p1 < ../ngx_req_status-master/write_filter.patch\n \n ./configure --prefix=/usr/local/nginx --add-module=/path/to/ngx_req_status-master\n \n make -j2\n \n make install\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Modify Nginx configure file"}),"\n",(0,i.jsxs)(n.p,{children:["update ",(0,i.jsx)(n.code,{children:"nginx.conf"})," file, add status module exposed endpoint, as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"# modify nginx.conf\nhttp {\n    req_status_zone server_name $server_name 256k;\n    req_status_zone server_addr $server_addr 256k;\n\n    req_status server_name server_addr;\n\n    server {\n        location /req-status {\n            req_status_show on;\n            #allow 127.0.0.1; #only allow requests from localhost\n          #deny all;  #deny all other hosts\n        }\n    }\n}\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Reload Nginx"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"\nnginx -s reload\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Access ",(0,i.jsx)(n.code,{children:"http://localhost/req-status"})," in the browser to view the Nginx monitoring status information."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Refer Doc: ",(0,i.jsx)(n.a,{href:"https://github.com/zls0424/ngx_req_status",children:"https://github.com/zls0424/ngx_req_status"})]})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["\u26a0\ufe0fAttention: The endpoint path of the monitoring module is ",(0,i.jsx)(n.code,{children:"/nginx-status"})," ",(0,i.jsx)(n.code,{children:"/req-status"})]})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-parameter",children:"Configuration parameter"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter name"}),(0,i.jsx)(n.th,{children:"Parameter help description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Monitoring Host"}),(0,i.jsx)(n.td,{children:"Monitored IPV4, IPV6 or domain name. Note\u26a0\ufe0fWithout protocol header (eg: https://, http://)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Monitoring name"}),(0,i.jsx)(n.td,{children:"Identify the name of this monitoring. The name needs to be unique"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Port"}),(0,i.jsx)(n.td,{children:"Port provided by Nginx"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Timeout"}),(0,i.jsx)(n.td,{children:"Allow collection response time"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Collection interval"}),(0,i.jsx)(n.td,{children:"Interval time of monitor periodic data collection, unit: second, and the minimum interval that can be set is 30 seconds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Whether to detect"}),(0,i.jsx)(n.td,{children:"Whether to detect and check the availability of monitoring before adding monitoring. Adding and modifying operations will continue only after the detection is successful"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Description remarks"}),(0,i.jsx)(n.td,{children:"For more information about identifying and describing this monitoring, users can note information here"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"collection-metrics",children:"Collection Metrics"}),"\n",(0,i.jsx)(n.h4,{id:"metrics-setnginx_status",children:"Metrics Set\uff1anginx_status"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric name"}),(0,i.jsx)(n.th,{children:"Metric unit"}),(0,i.jsx)(n.th,{children:"Metric help description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"accepts"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Accepted connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"handled"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Successfully processed connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"active"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Currently active connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"dropped"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Discarded connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"requests"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Client requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"reading"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Connections performing read operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"writing"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Connections performing write operations"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"waiting"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Waiting connections"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"metrics-setreq_status",children:"Metrics Set\uff1areq_status"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Metric name"}),(0,i.jsx)(n.th,{children:"Metric unit"}),(0,i.jsx)(n.th,{children:"Metric help description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"zone_name"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Group category"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"key"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Group name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"max_active"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Maximum concurrent connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"max_bw"}),(0,i.jsx)(n.td,{children:"kb"}),(0,i.jsx)(n.td,{children:"Maximum bandwidth"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"traffic"}),(0,i.jsx)(n.td,{children:"kb"}),(0,i.jsx)(n.td,{children:"Total traffic"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"requests"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Total requests"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"active"}),(0,i.jsx)(n.td,{}),(0,i.jsx)(n.td,{children:"Current concurrent connections"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"bandwidth"}),(0,i.jsx)(n.td,{children:"kb"}),(0,i.jsx)(n.td,{children:"Current bandwidth"})]})]})]})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);