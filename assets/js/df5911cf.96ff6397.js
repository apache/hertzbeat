"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[89290],{921:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"start/victoria-metrics-init","title":"Use Time Series Database VictoriaMetrics to Store Metrics Data (Recommended)","description":"Apache HertzBeat\'s historical data storage relies on the time series database, you can choose one of them to install and initialize, or not to install (note \u26a0\ufe0f but it is strongly recommended to configure in the production environment)","source":"@site/docs/start/victoria-metrics-init.md","sourceDirName":"start","slug":"/start/victoria-metrics-init","permalink":"/docs/start/victoria-metrics-init","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/docs/start/victoria-metrics-init.md","tags":[],"version":"current","frontMatter":{"id":"victoria-metrics-init","title":"Use Time Series Database VictoriaMetrics to Store Metrics Data (Recommended)","sidebar_label":"Metrics Store VictoriaMetrics (Recommended)"},"sidebar":"docs","previous":{"title":"Metrics Store Greptime (Recommended)","permalink":"/docs/start/greptime-init"},"next":{"title":"Metrics Store IoTDB","permalink":"/docs/start/iotdb-init"}}');var r=n(86070),o=n(45906);const s={id:"victoria-metrics-init",title:"Use Time Series Database VictoriaMetrics to Store Metrics Data (Recommended)",sidebar_label:"Metrics Store VictoriaMetrics (Recommended)"},a=void 0,c={},l=[{value:"Install VictoriaMetrics via Docker",id:"install-victoriametrics-via-docker",level:3},{value:"Use VictoriaMetrics in Cluster Mode",id:"use-victoriametrics-in-cluster-mode",level:3},{value:"1. Deploy VictoriaMetrics Cluster via Docker Compose",id:"1-deploy-victoriametrics-cluster-via-docker-compose",level:4},{value:"2. Configure HertzBeat for Cluster Mode",id:"2-configure-hertzbeat-for-cluster-mode",level:4},{value:"3. Restart HertzBeat",id:"3-restart-hertzbeat",level:4},{value:"FAQ",id:"faq",level:3}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Apache HertzBeat's historical data storage relies on the time series database, you can choose one of them to install and initialize, or not to install (note \u26a0\ufe0f but it is strongly recommended to configure in the production environment)"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"It is recommended to use VictoriaMetrics as metrics storage."}),"\n"]}),"\n",(0,r.jsxs)(t.p,{children:["VictoriaMetrics is a fast, cost-effective and scalable monitoring solution and time series database.Recommend Version(VictoriaMetrics",":v1",".95.1+, HertzBeat",":v1",".4.3+)"]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Note\u26a0\ufe0f Time series database is optional, but production environment configuration is strongly recommended to provide more complete historical chart functions and high performance"}),"\n",(0,r.jsx)(t.strong,{children:"\u26a0\ufe0f If you do not configure a time series database, only the last hour of historical data is retained."})]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"If you already have an VictoriaMetrics environment, you can skip directly to the YML configuration step."}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"install-victoriametrics-via-docker",children:"Install VictoriaMetrics via Docker"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Download and install Docker environment\nDocker tools download refer to ",(0,r.jsx)(t.a,{href:"https://docs.docker.com/get-docker/",children:"Docker official document"}),".\nAfter the installation you can check if the Docker version normally output at the terminal."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"$ docker -v\nDocker version 20.10.12, build e91ed57\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Install VictoriaMetrics via Docker"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"$ docker run -d -p 8428:8428 \\\n    -v $(pwd)/victoria-metrics-data:/victoria-metrics-data \\\n    --name victoria-metrics \\\n    victoriametrics/victoria-metrics:v1.95.1\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"-v $(pwd)/victoria-metrics-data:/victoria-metrics-data"})," is local persistent mount of VictoriaMetrics data directory\nuse",(0,r.jsx)(t.code,{children:"$ docker ps"})," to check if the database started successfully"]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:["Configure the database connection in hertzbeat ",(0,r.jsx)(t.code,{children:"application.yml"}),"configuration file"]}),"\n",(0,r.jsxs)(t.p,{children:["Modify ",(0,r.jsx)(t.code,{children:"hertzbeat/config/application.yml"})," configuration file\nNote\u26a0\ufe0fThe docker container way need to mount application.yml file locally, while you can use installation package way to unzip and modify ",(0,r.jsx)(t.code,{children:"hertzbeat/config/application.yml"}),"\nConfig the ",(0,r.jsx)(t.code,{children:"warehouse.store.jpa.enabled"})," ",(0,r.jsx)(t.code,{children:"false"}),". Replace ",(0,r.jsx)(t.code,{children:"warehouse.store.victoria-metrics"})," data source parameters, HOST account and password."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"warehouse:\n  store:\n     # disable JPA\n    jpa:\n      enabled: false\n    # enable victoria-metrics\n    victoria-metrics:\n       enabled: true\n       url: http://localhost:8428\n       username: root\n       password: root\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Restart HertzBeat"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"use-victoriametrics-in-cluster-mode",children:"Use VictoriaMetrics in Cluster Mode"}),"\n",(0,r.jsxs)(t.p,{children:["VictoriaMetrics provides a ",(0,r.jsx)(t.strong,{children:"cluster mode"})," with separate components for ingestion (",(0,r.jsx)(t.code,{children:"vminsert"}),"), storage (",(0,r.jsx)(t.code,{children:"vmstorage"}),"), and querying (",(0,r.jsx)(t.code,{children:"vmselect"}),"). The following section explains how to deploy VictoriaMetrics in cluster mode and integrate it with HertzBeat."]}),"\n",(0,r.jsx)(t.h4,{id:"1-deploy-victoriametrics-cluster-via-docker-compose",children:"1. Deploy VictoriaMetrics Cluster via Docker Compose"}),"\n",(0,r.jsxs)(t.p,{children:["Create a ",(0,r.jsx)(t.code,{children:"docker-compose.yml"})," file with the following content:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:'version: "3"\n\nservices:\n  vmstorage1:\n    image: victoriametrics/vmstorage\n    command:\n      - "-retentionPeriod=1"\n      - "-storageDataPath=/storage"\n    volumes:\n      - vmstorage-data:/storage\n    ports:\n      - "8400:8400"  # vminsert connects here\n      - "8401:8401"  # vmselect connects here\n\n  vminsert:\n    image: victoriametrics/vminsert\n    command:\n      - "-storageNode=vmstorage1:8400"\n      - "-httpAuth.username=root"\n      - "-httpAuth.password=root"\n    ports:\n      - "8480:8480"  # ingestion endpoint\n\n  vmselect:\n    image: victoriametrics/vmselect\n    command:\n      - "-storageNode=vmstorage1:8401"\n      - "-httpAuth.username=root"\n      - "-httpAuth.password=root"\n    ports:\n      - "8481:8481"  # query endpoint\n\nvolumes:\n  vmstorage-data:\n'})}),"\n",(0,r.jsx)(t.p,{children:"Start the cluster with:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"docker-compose up -d\n"})}),"\n",(0,r.jsx)(t.p,{children:"Check all components are running via:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"docker ps\n"})}),"\n",(0,r.jsx)(t.h4,{id:"2-configure-hertzbeat-for-cluster-mode",children:"2. Configure HertzBeat for Cluster Mode"}),"\n",(0,r.jsxs)(t.p,{children:["Edit the ",(0,r.jsx)(t.code,{children:"hertzbeat/config/application.yml"})," configuration file as follows:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",children:"warehouse:\n  store:\n    jpa:\n      enabled: false\n    victoria-metrics:\n      cluster:\n        enabled: true\n        select:\n          url: http://127.0.0.1:8481\n          username: root\n          password: root\n        insert:\n          url: http://127.0.0.1:8480\n          username: root\n          password: root\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Note:"})}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Set ",(0,r.jsx)(t.code,{children:"enabled: true"})," under ",(0,r.jsx)(t.code,{children:"cluster"})," to enable cluster mode."]}),"\n",(0,r.jsx)(t.li,{children:"Ensure the URLs match your Docker Compose network or deployment addresses."}),"\n"]}),"\n",(0,r.jsx)(t.h4,{id:"3-restart-hertzbeat",children:"3. Restart HertzBeat"}),"\n",(0,r.jsx)(t.p,{children:"Once configured, restart HertzBeat to connect to the VictoriaMetrics cluster."}),"\n",(0,r.jsx)(t.h3,{id:"faq",children:"FAQ"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Do both the time series databases need to be configured? Can they both be used?"}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"You don't need to configure all of them, you can choose one of them. Use the enable parameter to control whether it is used or not. You can also install and configure neither, which can affects the historical chart data."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},45906:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var i=n(30758);const r={},o=i.createContext(r);function s(e){const t=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:t},e.children)}}}]);