"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[55084],{45630:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=a(44320),o=(a(37953),a(58860));const r={id:"docker-deploy",title:"Install HertzBeat via Docker",sidebar_label:"Install via Docker"},i=void 0,l={unversionedId:"start/docker-deploy",id:"version-v1.6.x/start/docker-deploy",title:"Install HertzBeat via Docker",description:"Using Docker to start HertzBeat with the minimum available environment, no external service dependencies, easy to experience quickly.",source:"@site/versioned_docs/version-v1.6.x/start/docker-deploy.md",sourceDirName:"start",slug:"/start/docker-deploy",permalink:"/docs/v1.6.x/start/docker-deploy",draft:!1,editUrl:"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-v1.6.x/start/docker-deploy.md",tags:[],version:"v1.6.x",frontMatter:{id:"docker-deploy",title:"Install HertzBeat via Docker",sidebar_label:"Install via Docker"},sidebar:"docs",previous:{title:"Introduce",permalink:"/docs/v1.6.x/"},next:{title:"Install via Docker Compose",permalink:"/docs/v1.6.x/start/docker-compose-deploy"}},p={},s=[{value:"Deploy HertzBeat Server",id:"deploy-hertzbeat-server",level:3},{value:"Deploy HertzBeat Collector Cluster(Optional)",id:"deploy-hertzbeat-collector-clusteroptional",level:3},{value:"FAQ",id:"faq",level:3}],c={toc:s},m="wrapper";function d({components:e,...t}){return(0,o.yg)(m,(0,n.A)({},c,t,{components:e,mdxType:"MDXLayout"}),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"Using Docker to start HertzBeat with the minimum available environment, no external service dependencies, easy to experience quickly.\nBut it is not recommended to use in production environment, it is recommended to use Docker Compose deployment, installation package deployment, Kubernetes deployment in production environment.")),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"It is necessary to have Docker environment in your environment. If not installed, please refer to ",(0,o.yg)("a",{parentName:"p",href:"https://docs.docker.com/get-docker/"},"Docker official document"))),(0,o.yg)("h3",{id:"deploy-hertzbeat-server"},"Deploy HertzBeat Server"),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Execute the following command"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"$ docker run -d -p 1157:1157 -p 1158:1158 \\\n    -v $(pwd)/data:/opt/hertzbeat/data \\\n    -v $(pwd)/logs:/opt/hertzbeat/logs \\\n    -v $(pwd)/application.yml:/opt/hertzbeat/config/application.yml \\\n    -v $(pwd)/sureness.yml:/opt/hertzbeat/config/sureness.yml \\\n    --restart=always \\\n    --name hertzbeat apache/hertzbeat\n")),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"Command parameter explanation")),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d")," : Run a container in the background via Docker"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-p 1157:1157 -p 1158:1158"),"  : Mapping container ports to the host, 1157 is web-ui port, 1158 is cluster port."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/data:/opt/hertzbeat/data")," : (optional, data persistence) Important, Mount the H2 database file to the local host, to ensure that the data is not lost due creating or deleting container."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/logs:/opt/hertzbeat/logs")," : (optional) Mount the log file to the local host to facilitate viewing."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/application.yml:/opt/hertzbeat/config/application.yml"),"  : (optional) Mount the configuration file to the container (please ensure that the file exists locally). ",(0,o.yg)("a",{parentName:"li",href:"https://github.com/apache/hertzbeat/raw/master/script/application.yml"},"Download")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/sureness.yml:/opt/hertzbeat/config/sureness.yml"),"  : (optional) Mount the account configuration file to the container (please ensure that the file exists locally). ",(0,o.yg)("a",{parentName:"li",href:"https://github.com/apache/hertzbeat/raw/master/script/sureness.yml"},"Download")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/ext-lib:/opt/hertzbeat/ext-lib")," : (optional) Mount external third-party JAR package ",(0,o.yg)("a",{parentName:"li",href:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip"},"mysql-jdbc")," ",(0,o.yg)("a",{parentName:"li",href:"https://repo1.maven.org/maven2/com/oracle/database/jdbc/ojdbc8/23.4.0.24.05/ojdbc8-23.4.0.24.05.jar"},"oracle-jdbc")," ",(0,o.yg)("a",{parentName:"li",href:"https://repo.mavenlibs.com/maven/com/oracle/database/nls/orai18n/21.5.0.0/orai18n-21.5.0.0.jar"},"oracle-i18n")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"--name hertzbeat")," : (optional) Naming container name hertzbeat"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"--restart=always")," : (optional) Configure the container to restart automatically."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"apache/hertzbeat")," : Use the ",(0,o.yg)("a",{parentName:"li",href:"https://hub.docker.com/r/apache/hertzbeat"},"official application mirror")," to start the container, if the network times out, use ",(0,o.yg)("inlineCode",{parentName:"li"},"quay.io/tancloud/hertzbeat")," instead."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"--network host")," : (optional) Use the host network mode to start Docker, namely making Docker container and hosting share network. ",(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d --network host ....."))),(0,o.yg)("admonition",{parentName:"li",type:"tip"},(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},"Marked as optional parameters, non-mandatory items, if not needed, delete them."),(0,o.yg)("li",{parentName:"ul"},"This maps the 1157,1158 ports of the container to the 1157,1158 ports of the host. If the port on the host is already occupied, you need to modify the host mapping port."),(0,o.yg)("li",{parentName:"ul"},"When mounting files, the first parameter is your custom local file address, and the second parameter is the container file address. Make sure you have this file locally when mounting."),(0,o.yg)("li",{parentName:"ul"},"You can execute ",(0,o.yg)("inlineCode",{parentName:"li"},"docker update --restart=always hertzbeat")," to configure the container to restart automatically."),(0,o.yg)("li",{parentName:"ul"},"If you want to use the host network mode to start Docker, you can use ",(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d --network host ....."))))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Start to explore HertzBeat",(0,o.yg)("br",{parentName:"p"}),"\n","Access ",(0,o.yg)("a",{parentName:"p",href:"http://ip:1157/"},"http://ip:1157/")," using browser. You can explore HertzBeat with default account ",(0,o.yg)("inlineCode",{parentName:"p"},"admin/hertzbeat")," now!"))),(0,o.yg)("h3",{id:"deploy-hertzbeat-collector-clusteroptional"},"Deploy HertzBeat Collector Cluster(Optional)"),(0,o.yg)("admonition",{type:"note"},(0,o.yg)("p",{parentName:"admonition"},"HertzBeat Collector is a lightweight data collector used to collect and send data to HertzBeat Server.\nBy deploying multiple HertzBeat Collectors, high availability, load balancing, and cloud-edge collaboration of data can be achieved.")),(0,o.yg)("p",null,(0,o.yg)("img",{alt:"HertzBeat",src:a(80457).A,width:"2360",height:"846"})),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Execute the following command"),(0,o.yg)("pre",{parentName:"li"},(0,o.yg)("code",{parentName:"pre",className:"language-shell"},"$ docker run -d \\\n    -e IDENTITY=custom-collector-name \\\n    -e MODE=public \\\n    -e MANAGER_HOST=127.0.0.1 \\\n    -e MANAGER_PORT=1158 \\\n    --name hertzbeat-collector apache/hertzbeat-collector\n")),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"Command parameter explanation")),(0,o.yg)("ul",{parentName:"li"},(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d")," : Run a container in the background via Docker"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-e IDENTITY=custom-collector-name"),"  : (optional) Set the collector unique identity name. Attention the clusters collector name must unique."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-e MODE=public")," : set the running mode(public or private), public cluster or private"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-e MANAGER_HOST=127.0.0.1")," : Important, Set the main hertzbeat server ip host, must use the server host instead of 127.0.0.1."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-e MANAGER_PORT=1158")," :  (optional) Set the main hertzbeat server port, default 1158."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"-v $(pwd)/logs:/opt/hertzbeat-collector/logs")," : (optional) Mount the log file to the local host to facilitate viewing."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"--name hertzbeat-collector")," : Naming container name hertzbeat-collector"),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"apache/hertzbeat-collector")," : Use the ",(0,o.yg)("a",{parentName:"li",href:"https://hub.docker.com/r/apache/hertzbeat-collector"},"official application mirror")," to start the container, if the network times out, use ",(0,o.yg)("inlineCode",{parentName:"li"},"quay.io/tancloud/hertzbeat-collector")," instead."),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("inlineCode",{parentName:"li"},"--network host")," : (optional) Use the host network mode to start Docker, namely making Docker container and hosting share network. ",(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d --network host ....."))),(0,o.yg)("admonition",{parentName:"li",type:"tip"},(0,o.yg)("ul",{parentName:"admonition"},(0,o.yg)("li",{parentName:"ul"},"Marked as optional parameters, non-mandatory items, if not needed, delete them."),(0,o.yg)("li",{parentName:"ul"},"The ",(0,o.yg)("inlineCode",{parentName:"li"},"127.0.0.1")," in ",(0,o.yg)("inlineCode",{parentName:"li"},"MANAGER_HOST")," needs to be replaced with the external IP address of the HertzBeat Server."),(0,o.yg)("li",{parentName:"ul"},"When mounting files, the first parameter is your custom local file address, and the second parameter is the container file address. Make sure you have this file locally when mounting."),(0,o.yg)("li",{parentName:"ul"},"You can execute ",(0,o.yg)("inlineCode",{parentName:"li"},"docker update --restart=always hertzbeat-collector")," to configure the container to restart automatically."),(0,o.yg)("li",{parentName:"ul"},"If you want to use the host network mode to start Docker, you can use ",(0,o.yg)("inlineCode",{parentName:"li"},"docker run -d --network host ....."))))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Access ",(0,o.yg)("inlineCode",{parentName:"p"},"http://localhost:1157")," and you will see the registered new collector in dashboard."))),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"HAVE FUN")),(0,o.yg)("hr",null),(0,o.yg)("h3",{id:"faq"},"FAQ"),(0,o.yg)("p",null,(0,o.yg)("strong",{parentName:"p"},"The most common problem is network problems, please check in advance")),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"MYSQL, TDENGINE, IoTDB and HertzBeat are deployed on the same host by Docker,HertzBeat use localhost or 127.0.0.1 connect to the database but fail\nThe problems lies in Docker container failed to visit and connect localhost port. Because the docker default network mode is Bridge mode which can't access local machine through localhost."),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"Solution A\uff1aConfigure application.yml. Change database connection address from localhost to external IP of the host machine.",(0,o.yg)("br",{parentName:"p"}),"\n","Solution B\uff1aUse the Host network mode to start Docker, namely making Docker container and hosting share network. ",(0,o.yg)("inlineCode",{parentName:"p"},"docker run -d --network host .....")))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"According to the process deploy\uff0cvisit ",(0,o.yg)("a",{parentName:"p",href:"http://ip:1157/"},"http://ip:1157/")," no interface\nPlease refer to the following points to troubleshoot issues\uff1a"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"1\uff1aIf you switch to dependency service MYSQL database\uff0ccheck whether the database is created and started successfully.",(0,o.yg)("br",{parentName:"p"}),"\n","2\uff1aCheck whether dependent services, IP account and password configuration is correct in HertzBeat's configuration file ",(0,o.yg)("inlineCode",{parentName:"p"},"application.yml"),".",(0,o.yg)("br",{parentName:"p"}),"\n","3\uff1a",(0,o.yg)("inlineCode",{parentName:"p"},"docker logs hertzbeat")," Check whether the container log has errors. If you haven't solved the issue, report it to the communication group or community.  "))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"Historical monitoring charts have been missing data for a long time"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"1\uff1aCheck whether you configure victoria-metrics or Tdengine or IoTDB. No configuration means no historical chart data.",(0,o.yg)("br",{parentName:"p"}),"\n","2: Check whether IP account and password configuration is correct in HertzBeat's configuration file ",(0,o.yg)("inlineCode",{parentName:"p"},"application.yml"),"."))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"If the history chart on the monitoring page is not displayed\uff0cpopup ","[please configure time series database]"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"As shown in the popup window\uff0cthe premise of history chart display is that you need install and configure hertzbeat's dependency service database.",(0,o.yg)("br",{parentName:"p"}),"\n","Installation and initialization this database, please refer to ",(0,o.yg)("a",{parentName:"p",href:"victoria-metrics-init"},"Using victoria-metrics to store metrics data")))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"The time series database is installed and configured, but the page still displays a pop-up ","[Unable to provide historical chart data, please configure dependent time series database]"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"Please check if the configuration parameters are correct",(0,o.yg)("br",{parentName:"p"}),"\n","Is time-series database enable set to true",(0,o.yg)("br",{parentName:"p"}),"\n","Note\u26a0\ufe0fIf both hertzbeat and time-series database are started under the same host for docker containers, 127.0.0.1 cannot be used for communication between containers by default, and the host IP is changed",(0,o.yg)("br",{parentName:"p"}),"\n","You can check the startup logs according to the logs directory"))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"What is the purpose of application.yml"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"This file is the configuration file of HertzBeat, used to configure various parameters of HertzBeat, such as database connection information, time series database configuration, etc.\nDownload ",(0,o.yg)("inlineCode",{parentName:"p"},"application.yml")," file to the host directory, for example: $(pwd)/application.yml\nDownload source ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/apache/hertzbeat/raw/master/script/application.yml"},"github/script/application.yml"),"\nYou can modify the configuration yml file according to your needs."),(0,o.yg)("ul",{parentName:"blockquote"},(0,o.yg)("li",{parentName:"ul"},"If you need to use email to send alarms, you need to replace the email server parameters ",(0,o.yg)("inlineCode",{parentName:"li"},"spring.mail")," in ",(0,o.yg)("inlineCode",{parentName:"li"},"application.yml")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Recommended")," If you need to use an external Mysql database to replace the built-in H2 database, you need to replace the ",(0,o.yg)("inlineCode",{parentName:"li"},"spring.datasource")," parameter in ",(0,o.yg)("inlineCode",{parentName:"li"},"application.yml")," For specific steps, see ",(0,o.yg)("a",{parentName:"li",href:"mysql-change"},"Using Mysql to replace H2 database")),(0,o.yg)("li",{parentName:"ul"},(0,o.yg)("strong",{parentName:"li"},"Recommended")," If you need to use the time series database victoria-metrics to store metric data, you need to replace the ",(0,o.yg)("inlineCode",{parentName:"li"},"warehouse.store.victoria-metrics")," parameter in ",(0,o.yg)("inlineCode",{parentName:"li"},"application.yml")," for specific steps, see ",(0,o.yg)("a",{parentName:"li",href:"victoria-metrics-init"},"Using victoria-metrics to store metrics data"))))),(0,o.yg)("li",{parentName:"ol"},(0,o.yg)("p",{parentName:"li"},"What is the purpose of sureness.yml"),(0,o.yg)("blockquote",{parentName:"li"},(0,o.yg)("p",{parentName:"blockquote"},"This file is the user configuration file of HertzBeat, used to configure user information of HertzBeat, such as account password, etc.",(0,o.yg)("br",{parentName:"p"}),"\n","HertzBeat default built-in three user accounts, respectively ",(0,o.yg)("inlineCode",{parentName:"p"},"admin/hertzbeat tom/hertzbeat guest/hertzbeat"),(0,o.yg)("br",{parentName:"p"}),"\n","If you need update account or password, configure ",(0,o.yg)("inlineCode",{parentName:"p"},"sureness.yml"),". Ignore this step without this demand.",(0,o.yg)("br",{parentName:"p"}),"\n","Download and config ",(0,o.yg)("inlineCode",{parentName:"p"},"sureness.yml")," in the host directory\uff0ceg:",(0,o.yg)("inlineCode",{parentName:"p"},"$(pwd)/sureness.yml"),(0,o.yg)("br",{parentName:"p"}),"\n","Download from ",(0,o.yg)("a",{parentName:"p",href:"https://github.com/apache/hertzbeat/raw/master/script/sureness.yml"},"github/script/sureness.yml"),(0,o.yg)("br",{parentName:"p"}),"\n","For detail steps, please refer to ",(0,o.yg)("a",{parentName:"p",href:"account-modify"},"Configure Account Password"))))))}d.isMDXComponent=!0},58860:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>u});var n=a(37953);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach(function(t){o(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var p=n.createContext({}),s=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=s(e.components);return n.createElement(p.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},y=n.forwardRef(function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=s(a),y=o,u=m["".concat(p,".").concat(y)]||m[y]||d[y]||r;return a?n.createElement(u,i(i({ref:t},c),{},{components:a})):n.createElement(u,i({ref:t},c))});function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=y;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[m]="string"==typeof e?e:o,i[1]=l;for(var s=2;s<r;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}y.displayName="MDXCreateElement"},80457:(e,t,a)=>{a.d(t,{A:()=>n});const n=a.p+"assets/images/cluster-arch-f5cb9fea50e3ce406fb7b97d2c0add56.png"}}]);