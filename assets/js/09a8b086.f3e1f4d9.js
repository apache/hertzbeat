"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[45357],{78699(e,t,r){r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>o,metadata:()=>n,toc:()=>a});var n=r(8360),s=r(86070),i=r(60056);const o={title:"Behind the Scenes of HertzBeat: How Metric Collection Works",author:"JuJinPark",author_title:"JuJin",author_url:"https://github.com/JuJinPark",tags:["opensource","practice"],keywords:["open source monitoring system"]},l=void 0,c={authorsImageUrls:[void 0]},a=[{value:"Behind the Scenes of HertzBeat: How Metric Collection Works",id:"behind-the-scenes-of-hertzbeat-how-metric-collection-works",level:2},{value:"HertzBeat\u2019s Metric Collection Architecture",id:"hertzbeats-metric-collection-architecture",level:3},{value:"1. Job Distribution: Assigning What to Monitor",id:"1-job-distribution-assigning-what-to-monitor",level:3},{value:"2. Task Scheduling: When to Monitor",id:"2-task-scheduling-when-to-monitor",level:3},{value:"3. Task Execution: How Metrics Are Collected",id:"3-task-execution-how-metrics-are-collected",level:3},{value:"4. Result Processing: What Happens to Collected Data",id:"4-result-processing-what-happens-to-collected-data",level:3},{value:"5. Alerting &amp; Storage: Making Metrics Useful",id:"5-alerting--storage-making-metrics-useful",level:3},{value:"\ud83d\udd14 Alerting",id:"-alerting",level:4},{value:"\ud83e\udde0 Storage",id:"-storage",level:4},{value:"Standalone Mode: No External Collectors Required",id:"standalone-mode-no-external-collectors-required",level:3},{value:"\ud83e\udde0 Conclusion",id:"-conclusion",level:3},{value:"\ud83d\ude4c What\u2019s Next?",id:"-whats-next",level:3}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"behind-the-scenes-of-hertzbeat-how-metric-collection-works",children:"Behind the Scenes of HertzBeat: How Metric Collection Works"}),"\n",(0,s.jsx)(t.p,{children:"HertzBeat is an open-source, real-time monitoring system designed for flexibility and ease of use. But how exactly does it collect, process, and store metrics from various systems?"}),"\n",(0,s.jsxs)(t.p,{children:["In this post, we\u2019ll walk through the internal architecture behind ",(0,s.jsx)(t.strong,{children:"HertzBeat\u2019s metric collection pipeline"})," \u2014 from job distribution to alerting and storage \u2014 with the help of a high-level system diagram."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"hertzbeats-metric-collection-architecture",children:"HertzBeat\u2019s Metric Collection Architecture"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"HertzBeat Architecture",src:r(50375).A+"",width:"2796",height:"1256"})}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Figure:"})," High-level architecture of HertzBeat's metric collection system. The Manager handles job scheduling, alerting, and storage, while Collectors (external or internal) perform the actual metric collection. Communication between the Manager and Collectors uses a custom Netty TCP protocol."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"1-job-distribution-assigning-what-to-monitor",children:"1. Job Distribution: Assigning What to Monitor"}),"\n",(0,s.jsxs)(t.p,{children:["When the ",(0,s.jsx)(t.strong,{children:"Manager"})," component starts, it loads monitoring targets from the database. These targets define the host, collection interval, and other parameters."]}),"\n",(0,s.jsxs)(t.p,{children:["To distribute the workload, the Manager sends jobs to ",(0,s.jsx)(t.strong,{children:"external Collectors"})," over a custom ",(0,s.jsx)(t.strong,{children:"Netty-based TCP protocol"}),". The ",(0,s.jsx)(t.code,{children:"CollectJobScheduling"})," module handles this logic using ",(0,s.jsx)(t.strong,{children:"consistent hashing"}),", ensuring jobs are evenly distributed across collectors."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["\ud83d\udca1 HertzBeat also includes a built-in ",(0,s.jsx)(t.strong,{children:"main collector"})," (identified as ",(0,s.jsx)(t.code,{children:"MAIN_COLLECTOR_NODE"}),") that runs directly inside the Manager. This allows HertzBeat to operate in ",(0,s.jsx)(t.strong,{children:"standalone mode"})," without requiring any external collectors."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"2-task-scheduling-when-to-monitor",children:"2. Task Scheduling: When to Monitor"}),"\n",(0,s.jsxs)(t.p,{children:["Once a Collector receives a job, it registers it with the ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"TimerDispatch"})})," system."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["For ",(0,s.jsx)(t.strong,{children:"external collectors"}),", the Manager sends the task via the TCP connection."]}),"\n",(0,s.jsxs)(t.li,{children:["For the ",(0,s.jsx)(t.strong,{children:"main collector"}),", the Manager directly invokes ",(0,s.jsx)(t.code,{children:"CollectJobService"})," within the same process."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Each Collector runs a ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"Timer"})})," in a background thread, which schedules tasks according to their configured intervals. When the time is up, the timer triggers a ",(0,s.jsx)(t.code,{children:"TimerTask"})," to begin metric collection."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"3-task-execution-how-metrics-are-collected",children:"3. Task Execution: How Metrics Are Collected"}),"\n",(0,s.jsxs)(t.p,{children:["When a ",(0,s.jsx)(t.code,{children:"TimerTask"})," is triggered, it creates a ",(0,s.jsx)(t.code,{children:"MetricsCollect"})," task and passes it to ",(0,s.jsx)(t.code,{children:"MetricsTaskDispatch"}),", which places it in the ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"MetricsCollectorQueue"})}),"."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["A dedicated thread (",(0,s.jsx)(t.code,{children:"CommonDispatcher"}),") continuously polls this queue."]}),"\n",(0,s.jsxs)(t.li,{children:["Tasks are executed by a ",(0,s.jsx)(t.strong,{children:"worker thread pool"}),", allowing multiple metric collections to run concurrently."]}),"\n",(0,s.jsxs)(t.li,{children:["Each task uses a specific ",(0,s.jsx)(t.strong,{children:"collector strategy"})," (e.g., HTTP, JDBC, SSH) to fetch metrics from the target system."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"4-result-processing-what-happens-to-collected-data",children:"4. Result Processing: What Happens to Collected Data"}),"\n",(0,s.jsxs)(t.p,{children:["Once metrics are collected, the results are processed by the ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"CollectDataDispatch"})})," module."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["If the task is recurring, it is rescheduled via ",(0,s.jsx)(t.code,{children:"TimerDispatch"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Results are added to a ",(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"CommonDataQueue"})})," for further handling."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["For external collectors, results are sent ",(0,s.jsx)(t.strong,{children:"back to the Manager"})," via the Netty TCP connection. For the main collector, results are forwarded ",(0,s.jsx)(t.strong,{children:"directly"})," to the next processing stage without network overhead."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"5-alerting--storage-making-metrics-useful",children:"5. Alerting & Storage: Making Metrics Useful"}),"\n",(0,s.jsxs)(t.p,{children:["The Manager receives metric data and pushes it into the ",(0,s.jsx)(t.code,{children:"MetricsDataToAlertQueue"}),", where it is processed through two main pipelines:"]}),"\n",(0,s.jsx)(t.h4,{id:"-alerting",children:"\ud83d\udd14 Alerting"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["The ",(0,s.jsx)(t.code,{children:"RealTimeAlertCalculator"})," consumes metrics from the alert queue."]}),"\n",(0,s.jsx)(t.li,{children:"It checks each metric against user-defined alert rules and triggers alerts if conditions are met."}),"\n"]}),"\n",(0,s.jsx)(t.h4,{id:"-storage",children:"\ud83e\udde0 Storage"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["After alert evaluation, metrics are added to the ",(0,s.jsx)(t.code,{children:"MetricsDataToStorageQueue"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["A background thread (",(0,s.jsx)(t.code,{children:"DataStorageDispatch"}),") processes this queue and stores the metrics in a database for long-term analysis and dashboard visualization."]}),"\n"]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"standalone-mode-no-external-collectors-required",children:"Standalone Mode: No External Collectors Required"}),"\n",(0,s.jsxs)(t.p,{children:["Thanks to the built-in ",(0,s.jsx)(t.strong,{children:"main collector"}),", HertzBeat can operate entirely in standalone mode. This is especially useful for testing, small deployments, or quick setup. All core components \u2014 job scheduling, collection, alerting, and storage \u2014 run within a single process."]}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"-conclusion",children:"\ud83e\udde0 Conclusion"}),"\n",(0,s.jsxs)(t.p,{children:["HertzBeat\u2019s metric collection system is designed for ",(0,s.jsx)(t.strong,{children:"performance, scalability, and flexibility"}),". With its:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.strong,{children:"Queue-based, multi-threaded architecture"})}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Persistent TCP connections"})," for reliable job/result flow"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Built-in main collector"})," for standalone operation"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"it handles large-scale monitoring workloads with minimal overhead and high efficiency."}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.h3,{id:"-whats-next",children:"\ud83d\ude4c What\u2019s Next?"}),"\n",(0,s.jsx)(t.p,{children:"If you're curious to explore more:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\u2b50\ufe0f ",(0,s.jsx)(t.a,{href:"https://github.com/apache/hertzbeat",children:"Star the project on GitHub"})]}),"\n",(0,s.jsxs)(t.li,{children:["\ud83e\udd1d ",(0,s.jsx)(t.a,{href:"https://github.com/apache/hertzbeat/issues",children:"Contribute or open an issue"})]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},50375(e,t,r){r.d(t,{A:()=>n});const n=r.p+"assets/images/hertzbeat-metrics-collection-arch-7c804671e1309b2b4227976d69ad515c.png"},60056(e,t,r){r.d(t,{R:()=>o,x:()=>l});var n=r(30758);const s={},i=n.createContext(s);function o(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:t},e.children)}},8360(e){e.exports=JSON.parse('{"permalink":"/blog/2025/03/30/how-does-metrics-collection-work","editUrl":"https://github.com/apache/hertzbeat/edit/master/home/blog/2025-03-30-how-does-metrics-collection-work.md","source":"@site/blog/2025-03-30-how-does-metrics-collection-work.md","title":"Behind the Scenes of HertzBeat: How Metric Collection Works","description":"Behind the Scenes of HertzBeat: How Metric Collection Works","date":"2025-03-30T00:00:00.000Z","tags":[{"inline":true,"label":"opensource","permalink":"/blog/tags/opensource"},{"inline":true,"label":"practice","permalink":"/blog/tags/practice"}],"readingTime":3.13,"hasTruncateMarker":false,"authors":[{"name":"JuJinPark","title":"JuJin","url":"https://github.com/JuJinPark","key":null,"page":null}],"frontMatter":{"title":"Behind the Scenes of HertzBeat: How Metric Collection Works","author":"JuJinPark","author_title":"JuJin","author_url":"https://github.com/JuJinPark","tags":["opensource","practice"],"keywords":["open source monitoring system"]},"unlisted":false,"prevItem":{"title":"From Commiter to PMC\uff1a The Journey of Growth at Apache HertzBeat\u2122","permalink":"/blog/2025/04/06/new-pmc"},"nextItem":{"title":"Warmly Welcome HertzBeat\'s New Community Committer!","permalink":"/blog/2025/03/10/new-committer"}}')}}]);