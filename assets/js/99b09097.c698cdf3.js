"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[31072],{8301(e,a,t){t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>d});var r=t(44320),n=(t(37953),t(58860));const o={},l="HertzBeat Upgrade Guide (Docker Mode)",i={permalink:"/blog/2025/04/23/hertzbeat-upgrade-guide-docker-mode",editUrl:"https://github.com/apache/hertzbeat/edit/master/home/blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md",source:"@site/blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md",title:"HertzBeat Upgrade Guide (Docker Mode)",description:"Docker-based Upgrade",date:"2025-04-23T00:00:00.000Z",formattedDate:"April 23, 2025",tags:[],readingTime:1.41,hasTruncateMarker:!1,authors:[],frontMatter:{},prevItem:{title:"From User to PPMC Member: Contributing to Open Source with Passion at Apache HertzBeat",permalink:"/blog/2025/5/19/new-pmc"},nextItem:{title:"HertzBeat Upgrade Guide from v1.6.1 to v1.7.0 (Helm Mode)",permalink:"/blog/2025/04/23/hertzbeat-upgrade-guide-from-v1.6.1-to-v1.7.0-helm-mode"}},p={authorsImageUrls:[]},d=[{value:"Docker-based Upgrade",id:"docker-based-upgrade",level:2},{value:"1. Data Backup",id:"1-data-backup",level:3},{value:"2. Stop and Remove the HertzBeat Container",id:"2-stop-and-remove-the-hertzbeat-container",level:3},{value:"3. Upgrade Database Schema",id:"3-upgrade-database-schema",level:3},{value:"4. Restart HertzBeat with the New Image",id:"4-restart-hertzbeat-with-the-new-image",level:3},{value:"5. Update Configuration Files",id:"5-update-configuration-files",level:3},{value:"6. Add Database Drivers",id:"6-add-database-drivers",level:3}],s={toc:d};function c({components:e,...a}){return(0,n.yg)("wrapper",(0,r.A)({},s,a,{components:e,mdxType:"MDXLayout"}),(0,n.yg)("h2",{id:"docker-based-upgrade"},"Docker-based Upgrade"),(0,n.yg)("h3",{id:"1-data-backup"},"1. Data Backup"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Back up the database"),": Manually back up MySQL data as needed."),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},'mysqldump -h<HOST-IP> -P<PORT> -uroot -p"PASSWORD" <DB_NAME> > hertzbeat_backup-`date +%Y-%m-%d`.sql  # Single database  \nmysqldump -h<HOST-IP> -P<PORT> -uroot -p"PASSWORD" --all-databases > hertzbeat_backup-`date +%Y-%m-%d`.sql  # Full database  \n'))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},"Back up configuration files and data directory"),":"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"mv application.yml application-bak.yml && mv sureness.yml sureness-bak.yml  \ncp -R data data-`date +%Y-%m-%d`.bak  \n")))),(0,n.yg)("h3",{id:"2-stop-and-remove-the-hertzbeat-container"},"2. Stop and Remove the HertzBeat Container"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"docker stop hertzbeat && docker rm hertzbeat  \n")),(0,n.yg)("h3",{id:"3-upgrade-database-schema"},"3. Upgrade Database Schema"),(0,n.yg)("p",null,"Navigate to ",(0,n.yg)("a",{parentName:"p",href:"https://github.com/apache/hertzbeat/tree/master/hertzbeat-startup/src/main/resources/db/migration"},"HertzBeat GitHub Migration Scripts"),", select the appropriate ",(0,n.yg)("inlineCode",{parentName:"p"},"V160__update_column.sql")," file under your database type (e.g., MySQL), and execute it in MySQL."),(0,n.yg)("h3",{id:"4-restart-hertzbeat-with-the-new-image"},"4. Restart HertzBeat with the New Image"),(0,n.yg)("pre",null,(0,n.yg)("code",{parentName:"pre",className:"language-bash"},"docker run -d -p 1157:1157 -p 1158:1158 \\  \n    -v $(pwd)/data:/opt/hertzbeat/data \\  \n    -v $(pwd)/logs:/opt/hertzbeat/logs \\  \n    -v $(pwd)/application.yml:/opt/hertzbeat/config/application.yml \\  \n    -v $(pwd)/sureness.yml:/opt/hertzbeat/config/sureness.yml \\  \n    --restart=always \\  \n    --name hertzbeat apache/hertzbeat:v1.7.0  \n")),(0,n.yg)("h3",{id:"5-update-configuration-files"},"5. Update Configuration Files"),(0,n.yg)("p",null,"Modify the backup configurations as needed:"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},(0,n.yg)("inlineCode",{parentName:"strong"},"application.yml"))," (Typical modifications):"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"datasource:\n  driver-class-name: com.mysql.cj.jdbc.Driver\n  username: root\n  password: root\n  url: jdbc:mysql://localhost:3306/hertzbeat?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai\n  hikari:\n    max-lifetime: 120000\n\njpa:\n  show-sql: false\n  database-platform: org.eclipse.persistence.platform.database.MySQLPlatform\n  database: mysql\n  properties:\n    eclipselink:\n      logging:\n        level: SEVERE\n"))),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("p",{parentName:"li"},(0,n.yg)("strong",{parentName:"p"},(0,n.yg)("inlineCode",{parentName:"strong"},"sureness.yml"))," (Optional, modify for account/password changes):"),(0,n.yg)("pre",{parentName:"li"},(0,n.yg)("code",{parentName:"pre",className:"language-yaml"},"account:\n  - appId: admin\n    credential: hertzbeat\n    role: [admin]\n  - appId: tom\n    credential: hertzbeat\n    role: [user]\n  - appId: guest\n    credential: hertzbeat\n    role: [guest]\n  - appId: lili\n    credential: 94C6B34E7A199A9F9D4E1F208093B489\n    salt: 123\n    role: [user]\n")))),(0,n.yg)("h3",{id:"6-add-database-drivers"},"6. Add Database Drivers"),(0,n.yg)("p",null,"Due to Apache Foundation\u2019s license compliance requirements, HertzBeat cannot include GPL-licensed dependencies (e.g., MySQL, Oracle). Users must manually download drivers and place them in the ",(0,n.yg)("inlineCode",{parentName:"p"},"ext-lib")," directory, then mount it to ",(0,n.yg)("inlineCode",{parentName:"p"},"/opt/hertzbeat/ext-lib"),":"),(0,n.yg)("ul",null,(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"MySQL Driver"),": ",(0,n.yg)("a",{parentName:"li",href:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip"},"Download MySQL Connector/J 8.0.25")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("strong",{parentName:"li"},"Oracle Driver")," (Required for Oracle monitoring):",(0,n.yg)("ul",{parentName:"li"},(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://download.oracle.com/otn-pub/otn_software/jdbc/234/ojdbc8.jar"},"ojdbc8.jar")),(0,n.yg)("li",{parentName:"ul"},(0,n.yg)("a",{parentName:"li",href:"https://repo.mavenlibs.com/maven/com/oracle/database/nls/orai18n/21.5.0.0/orai18n-21.5.0.0.jar"},"orai18n-21.5.0.0.jar"))))))}c.isMDXComponent=!0},58860(e,a,t){t.d(a,{xA:()=>s,yg:()=>u});var r=t(37953);function n(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),t.push.apply(t,r)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach(function(a){n(e,a,t[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})}return e}function i(e,a){if(null==e)return{};var t,r,n=function(e,a){if(null==e)return{};var t,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||(n[t]=e[t]);return n}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}var p=r.createContext({}),d=function(e){var a=r.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},s=function(e){var a=d(e.components);return r.createElement(p.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},m=r.forwardRef(function(e,a){var t=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),m=d(t),u=n,g=m["".concat(p,".").concat(u)]||m[u]||c[u]||o;return t?r.createElement(g,l(l({ref:a},s),{},{components:t})):r.createElement(g,l({ref:a},s))});function u(e,a){var t=arguments,n=a&&a.mdxType;if("string"==typeof e||n){var o=t.length,l=new Array(o);l[0]=m;var i={};for(var p in a)hasOwnProperty.call(a,p)&&(i[p]=a[p]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var d=2;d<o;d++)l[d]=t[d];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"}}]);