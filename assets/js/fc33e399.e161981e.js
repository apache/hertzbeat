"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[554],{27006:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"advanced/extend-http-xmlpath","title":"HTTP Protocol XmlPath Parsing Method","description":"After calling the HTTP API to obtain the response data, use the XmlPath script parsing method to parse the response data.","source":"@site/versioned_docs/version-1.8.0/advanced/extend-http-xmlpath.md","sourceDirName":"advanced","slug":"/advanced/extend-http-xmlpath","permalink":"/docs/advanced/extend-http-xmlpath","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-1.8.0/advanced/extend-http-xmlpath.md","tags":[],"version":"1.8.0","frontMatter":{"id":"extend-http-xmlpath","title":"HTTP Protocol XmlPath Parsing Method","sidebar_label":"XmlPath Parsing Method"},"sidebar":"docs","previous":{"title":"JsonPath Parsing Method","permalink":"/docs/advanced/extend-http-jsonpath"},"next":{"title":"Tutorial 1 Adapting an HTTP protocol monitoring","permalink":"/docs/advanced/extend-http-example-hertzbeat"}}');var s=t(86070),a=t(45906);const o={id:"extend-http-xmlpath",title:"HTTP Protocol XmlPath Parsing Method",sidebar_label:"XmlPath Parsing Method"},r=void 0,l={},d=[{value:"XmlPath Parsing Logic",id:"xmlpath-parsing-logic",level:3},{value:"Example",id:"example",level:3}];function m(e){const n={blockquote:"blockquote",code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"After calling the HTTP API to obtain the response data, use the XmlPath script parsing method to parse the response data."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Note\u26a0\ufe0f The response data must be in XML format."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Use XPath scripts to parse the response data into data that conforms to the data structure rules specified by HertzBeat."})}),"\n",(0,s.jsx)(n.h3,{id:"xmlpath-parsing-logic",children:"XmlPath Parsing Logic"}),"\n",(0,s.jsx)(n.p,{children:"The XmlPath parsing method in HertzBeat uses a two-step XPath process:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Main XPath Expression (",(0,s.jsx)(n.code,{children:"parseScript"}),")"]}),": This XPath expression is defined in the ",(0,s.jsx)(n.code,{children:"http"})," configuration section under ",(0,s.jsx)(n.code,{children:"parseScript"}),". It is used to select one or more main XML nodes from the response. Each selected node will correspond to one row of metric data in HertzBeat."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:["Relative Field XPath Expressions (",(0,s.jsx)(n.code,{children:"xpath"}),")"]}),": For each metric field defined in the ",(0,s.jsx)(n.code,{children:"fields"})," list, you can specify a relative ",(0,s.jsx)(n.code,{children:"xpath"}),". This XPath expression is evaluated ",(0,s.jsx)(n.em,{children:"relative to each main node"})," selected by the ",(0,s.jsx)(n.code,{children:"parseScript"})," in step 1. It extracts the specific value for that metric field from the current main node."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This allows you to easily parse structured XML data where multiple records or items are present."}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Special Metrics"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"responseTime"}),": This built-in metric represents the HTTP request's response time and is automatically collected. It does not require an ",(0,s.jsx)(n.code,{children:"xpath"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"keyword"}),": This built-in metric counts the occurrences of a specified keyword (configured in ",(0,s.jsx)(n.code,{children:"http.keyword"}),") in the raw response body. It does not require an ",(0,s.jsx)(n.code,{children:"xpath"}),"."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsx)(n.p,{children:"Assume the HTTP API returns the following XML data:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:'<DeviceStatus xmlns="http://www.isapi.org/ver20/XMLSchema" version="2.0">\n    <CPUList>\n        <CPU>\n            <cpuUtilization>36.400002</cpuUtilization>\n        <CPU>\n    <CPUList>\n    <MemoryList>\n        <Memory>\n            <memoryUsage>399640</memoryUsage>\n            <memoryAvailable>98792</memoryAvailable>\n            <cacheSize>228492</cacheSize>\n        <Memory>\n    <MemoryList>\n    <NetPortStatusList>\n        <NetPortStatus>\n            <id>1</id>\n            <workSpeed>1000</workSpeed>\n        <NetPortStatus>\n        <NetPortStatus>\n            <id>2</id>\n            <workSpeed>0</workSpeed>\n        <NetPortStatus>\n    <NetPortStatusList>\n    <bootTime>2025-01-06 10:27:48</bootTime>\n    <deviceUpTime>87\u59290\u65f655\u520659\u79d2</deviceUpTime>\n    <lastCalibrationTime>2025-04-03 11:09:18</lastCalibrationTime>\n    <lastCalibrationTimeDiff>1</lastCalibrationTimeDiff>\n    <uploadTimeConsumingList>\n        <avgTime>16</avgTime>\n        <maxTime>23</maxTime>\n        <minTime>12</minTime>\n    </uploadTimeConsumingList>\n    <lastCalibrationTimeMode>NTP</lastCalibrationTimeMode>\n    <lastCalibrationTimeAddress>34.191.45.101</lastCalibrationTimeAddress>\n<DeviceStatus>\n'})}),"\n",(0,s.jsx)(n.p,{children:"We want to monitor the device status and extract various metrics."}),"\n",(0,s.jsx)(n.p,{children:"Here's how you would configure the monitoring template YML:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"category: server\n# The monitoring type eg: linux windows tomcat mysql aws...\napp: hikvision_isapi\n# The monitoring i18n name\nname:\n  zh-CN: \u6d77\u5eb7\u5a01\u89c6 ISAPI\n  en-US: Hikvision ISAPI\n# The description and help of this monitoring type\nhelp:\n  zh-CN: \u901a\u8fc7ISAPI\u63a5\u53e3\u76d1\u63a7\u6d77\u5eb7\u5a01\u89c6\u8bbe\u5907\u72b6\u6001\uff0c\u83b7\u53d6\u8bbe\u5907\u5065\u5eb7\u6570\u636e\u3002\n  en-US: Monitor Hikvision devices through ISAPI interface to collect health data.\n\n# Input params define for monitoring(render web ui by the definition)\nparams:\n  - field: host\n    name:\n      zh-CN: \u4e3b\u673aHost\n      en-US: Host\n    type: host\n    required: true\n  - field: port\n    name:\n      zh-CN: \u7aef\u53e3\n      en-US: Port\n    type: number\n    range: '[0,65535]'\n    required: true\n    defaultValue: 80\n  - field: timeout\n    name:\n      zh-CN: \u8d85\u65f6\u65f6\u95f4(ms)\n      en-US: Timeout(ms)\n    type: number\n    range: '[1000,60000]'\n    required: true\n    defaultValue: 5000\n  - field: username\n    name:\n      zh-CN: \u7528\u6237\u540d\n      en-US: Username\n    type: text\n    required: true\n  - field: password\n    name:\n      zh-CN: \u5bc6\u7801\n      en-US: Password\n    type: password\n    required: true\n  - field: ssl\n    name:\n      zh-CN: \u542f\u7528HTTPS\n      en-US: SSL\n    type: boolean\n    required: false\n    defaultValue: false\n\n# collect metrics config list\nmetrics:\n  - name: system_info\n    i18n:\n      zh-CN: \u7cfb\u7edf\u4fe1\u606f\n      en-US: System Info\n    priority: 0\n    protocol: http\n    http:\n      host: ^_^host^_^\n      port: ^_^port^_^\n      ssl: ^_^ssl^_^\n      url: /ISAPI/System/deviceInfo\n      method: GET\n      timeout: ^_^timeout^_^\n      authorization:\n        type: Digest Auth\n        digestAuthUsername: ^_^username^_^\n        digestAuthPassword: ^_^password^_^\n      parseType: xmlPath\n      parseScript: //DeviceInfo\n    fields:\n      - field: deviceName\n        type: 1\n        i18n:\n          zh-CN: \u8bbe\u5907\u540d\u79f0\n          en-US: Device Name\n      - field: deviceID\n        type: 1\n        i18n:\n          zh-CN: \u8bbe\u5907ID\n          en-US: Device ID\n      - field: firmwareVersion\n        type: 1\n        i18n:\n          zh-CN: \u56fa\u4ef6\u7248\u672c\n          en-US: Firmware Version\n      - field: model\n        type: 1\n        i18n:\n          zh-CN: \u8bbe\u5907\u578b\u53f7\n          en-US: Device Model\n      - field: macAddress\n        type: 1\n        i18n:\n          zh-CN: mac\u5730\u5740\n          en-US: Mac Address\n  - name: status\n    i18n:\n      zh-CN: \u8bbe\u5907\u72b6\u6001\n      en-US: Status\n    priority: 0\n    protocol: http\n    http:\n      host: ^_^host^_^\n      port: ^_^port^_^\n      ssl: ^_^ssl^_^\n      url: /ISAPI/System/status\n      method: GET\n      timeout: ^_^timeout^_^\n      authorization:\n        type: Digest Auth\n        digestAuthUsername: ^_^username^_^\n        digestAuthPassword: ^_^password^_^\n      parseType: xmlPath\n      parseScript: //DeviceStatus\n    fields:\n      - field: CPU_utilization\n        i18n:\n          zh-CN: CPU \u5229\u7528\u7387\n          en-US: CPU Utilization\n        type: 0\n        unit: '%'\n      - field: memory_usage\n        i18n:\n          zh-CN: \u5185\u5b58\u4f7f\u7528\u91cf\n          en-US: Memory Usage\n        type: 0\n        unit: MB\n      - field: memory_available\n        i18n:\n          zh-CN: \u53ef\u7528\u5185\u5b58\n          en-US: Memory Available\n        type: 0\n        unit: MB\n      - field: cache_size\n        i18n:\n          zh-CN: \u7f13\u5b58\u5927\u5c0f\n          en-US: Cache Size\n        type: 0\n        unit: MB\n      - field: net_port_1_speed\n        i18n:\n          zh-CN: \u7f51\u53e31\u901f\u5ea6\n          en-US: Net Port 1 Speed\n        type: 0\n        unit: Mbps\n      - field: net_port_2_speed\n        i18n:\n          zh-CN: \u7f51\u53e32\u901f\u5ea6\n          en-US: Net Port 2 Speed\n        type: 0\n        unit: Mbps\n      - field: boot_time\n        i18n:\n          zh-CN: \u542f\u52a8\u65f6\u95f4\n          en-US: Boot Time\n        type: 1\n      - field: device_uptime\n        i18n:\n          zh-CN: \u8fd0\u884c\u65f6\u957f\n          en-US: Device Uptime\n        type: 1\n      - field: last_calibration_time\n        i18n:\n          zh-CN: \u4e0a\u6b21\u6821\u65f6\u65f6\u95f4\n          en-US: Last Calibration Time\n        type: 1\n      - field: last_calibration_time_diff\n        i18n:\n          zh-CN: \u4e0a\u6b21\u6821\u65f6\u65f6\u95f4\u5dee\n          en-US: Last Calibration Time Diff\n        type: 0\n        unit: s\n      - field: avg_upload_time\n        i18n:\n          zh-CN: \u5e73\u5747\u4e0a\u4f20\u8017\u65f6\n          en-US: Avg Upload Time\n        type: 0\n        unit: ms\n      - field: max_upload_time\n        i18n:\n          zh-CN: \u6700\u5927\u4e0a\u4f20\u8017\u65f6\n          en-US: Max Upload Time\n        type: 0\n        unit: ms\n      - field: min_upload_time\n        i18n:\n          zh-CN: \u6700\u5c0f\u4e0a\u4f20\u8017\u65f6\n          en-US: Min Upload Time\n        type: 0\n        unit: ms\n      - field: last_calibration_mode\n        i18n:\n          zh-CN: \u4e0a\u6b21\u6821\u65f6\u6a21\u5f0f\n          en-US: Last Calibration Mode\n        type: 1\n      - field: last_calibration_address\n        i18n:\n          zh-CN: \u4e0a\u6b21\u6821\u65f6\u5730\u5740\n          en-US: Last Calibration Address\n        type: 1\n      - field: response_time\n        i18n:\n          zh-CN: \u54cd\u5e94\u65f6\u95f4\n          en-US: Response Time\n        type: 0\n        unit: ms\n    aliasFields:\n      - CPUList/CPU/cpuUtilization\n      - MemoryList/Memory/memoryUsage\n      - MemoryList/Memory/memoryAvailable\n      - MemoryList/Memory/cacheSize\n      - NetPortStatusList/NetPortStatus[id='1']/workSpeed\n      - NetPortStatusList/NetPortStatus[id='2']/workSpeed\n      - bootTime\n      - deviceUpTime\n      - lastCalibrationTime\n      - lastCalibrationTimeDiff\n      - uploadTimeConsumingList/avgTime\n      - uploadTimeConsumingList/maxTime\n      - uploadTimeConsumingList/minTime\n      - lastCalibrationTimeMode\n      - lastCalibrationTimeAddress\n      - responseTime\n    calculates:\n      - CPU_utilization=CPUList/CPU/cpuUtilization\n      - memory_usage=MemoryList/Memory/memoryUsage\n      - memory_available=MemoryList/Memory/memoryAvailable\n      - cache_size=MemoryList/Memory/cacheSize\n      - net_port_1_speed=NetPortStatusList/NetPortStatus[id='1']/workSpeed\n      - net_port_2_speed=NetPortStatusList/NetPortStatus[id='2']/workSpeed\n      - boot_time=bootTime\n      - device_uptime=deviceUpTime\n      - last_calibration_time=lastCalibrationTime\n      - last_calibration_time_diff=lastCalibrationTimeDiff\n      - avg_upload_time=uploadTimeConsumingList/avgTime\n      - max_upload_time=uploadTimeConsumingList/maxTime\n      - min_upload_time=uploadTimeConsumingList/minTime\n      - last_calibration_mode=lastCalibrationTimeMode\n      - last_calibration_address=lastCalibrationTimeAddress\n      - response_time=responseTime\n    units:\n      - memory_usage=KB->MB\n      - memory_available=KB->MB\n      - cache_size=KB->MB\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},45906:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(30758);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);