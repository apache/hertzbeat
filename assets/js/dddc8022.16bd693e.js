"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[66924],{58860(e,t,n){n.d(t,{xA:()=>g,yg:()=>p});var r=n(37953);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){a(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},g=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef(function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,g=l(e,["components","mdxType","originalType","parentName"]),m=c(n),p=a,y=m["".concat(s,".").concat(p)]||m[p]||u[p]||i;return n?r.createElement(y,o(o({ref:t},g),{},{components:n})):r.createElement(y,o({ref:t},g))});function p(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,o[1]=l;for(var c=2;c<i;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},92645(e,t,n){n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=n(44320),a=(n(37953),n(58860));const i={id:"consul_sd",title:"Monitoring Consul Service Discovery",sidebar_label:"Consul Service Discovery",keywords:["open source monitoring tool","open source service discovery monitoring tool","monitoring Consul service discovery"]},o=void 0,l={unversionedId:"help/consul_sd",id:"help/consul_sd",title:"Monitoring Consul Service Discovery",description:"HertzBeat integrates with Consul registry to automatically discover service instances and create monitoring tasks for them.",source:"@site/docs/help/consul_sd.md",sourceDirName:"help",slug:"/help/consul_sd",permalink:"/docs/help/consul_sd",draft:!1,editUrl:"https://github.com/apache/hertzbeat/edit/master/home/docs/help/consul_sd.md",tags:[],version:"current",frontMatter:{id:"consul_sd",title:"Monitoring Consul Service Discovery",sidebar_label:"Consul Service Discovery",keywords:["open source monitoring tool","open source service discovery monitoring tool","monitoring Consul service discovery"]},sidebar:"docs",previous:{title:"Nacos Service Discovery",permalink:"/docs/help/nacos_sd"},next:{title:"Zookeeper Service Discovery",permalink:"/docs/help/zookeeper_sd"}},s={},c=[{value:"Overview",id:"overview",level:3},{value:"PreRequisites",id:"prerequisites",level:3},{value:"Deploy Consul Server",id:"deploy-consul-server",level:4},{value:"Configuration parameter",id:"configuration-parameter",level:3},{value:"Usage Steps",id:"usage-steps",level:3},{value:"Example of usage",id:"example-of-usage",level:3},{value:"Notes",id:"notes",level:3},{value:"Collection Metric",id:"collection-metric",level:3},{value:"Metric set: Monitor Target",id:"metric-set-monitor-target",level:4},{value:"Use Cases",id:"use-cases",level:3},{value:"Integration with Consul Features",id:"integration-with-consul-features",level:3}],g={toc:c};function u({components:e,...t}){return(0,a.yg)("wrapper",(0,r.A)({},g,t,{components:e,mdxType:"MDXLayout"}),(0,a.yg)("blockquote",null,(0,a.yg)("p",{parentName:"blockquote"},"HertzBeat integrates with Consul registry to automatically discover service instances and create monitoring tasks for them.")),(0,a.yg)("h3",{id:"overview"},"Overview"),(0,a.yg)("p",null,"Consul Service Discovery allows HertzBeat to connect to your Consul server and automatically discover all registered service instances. When a new service instance is registered or an existing instance goes offline, HertzBeat will automatically create or delete corresponding monitoring tasks, achieving automated monitoring in microservice environments."),(0,a.yg)("h3",{id:"prerequisites"},"PreRequisites"),(0,a.yg)("h4",{id:"deploy-consul-server"},"Deploy Consul Server"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"Deploy Consul server according to ",(0,a.yg)("a",{parentName:"li",href:"https://www.consul.io/docs/install"},"Consul official documentation"),"."),(0,a.yg)("li",{parentName:"ol"},"Ensure Consul server is accessible from HertzBeat."),(0,a.yg)("li",{parentName:"ol"},"Verify that you can access Consul UI at ",(0,a.yg)("inlineCode",{parentName:"li"},"http://your-consul-server:8500/ui/")),(0,a.yg)("li",{parentName:"ol"},"Ensure the Consul HTTP API is accessible (default port: 8500)")),(0,a.yg)("h3",{id:"configuration-parameter"},"Configuration parameter"),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Parameter name"),(0,a.yg)("th",{parentName:"tr",align:null},"Parameter help description"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"Target Name"),(0,a.yg)("td",{parentName:"tr",align:null},"Identify the name of this monitoring. The name needs to be unique.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"Consul Host"),(0,a.yg)("td",{parentName:"tr",align:null},"Consul server IP address or domain name. Note\u26a0\ufe0fWithout protocol header (eg: https://, http://). Example: ",(0,a.yg)("inlineCode",{parentName:"td"},"consul-server")," or ",(0,a.yg)("inlineCode",{parentName:"td"},"192.168.1.100"))),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"Consul Port"),(0,a.yg)("td",{parentName:"tr",align:null},"Port provided by the Consul server. The default is 8500")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"Collection interval"),(0,a.yg)("td",{parentName:"tr",align:null},"Interval time of monitor periodic data collection, unit: second, and the minimum interval that can be set is 30 seconds.")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"Description remarks"),(0,a.yg)("td",{parentName:"tr",align:null},"For more information about identifying and describing this monitoring, users can note information here.")))),(0,a.yg)("h3",{id:"usage-steps"},"Usage Steps"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"Create Service Discovery Monitoring")),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"In HertzBeat web UI, navigate to ",(0,a.yg)("strong",{parentName:"li"},"Monitoring")," \u2192 ",(0,a.yg)("strong",{parentName:"li"},"New Monitoring")),(0,a.yg)("li",{parentName:"ul"},"Select monitoring type: ",(0,a.yg)("strong",{parentName:"li"},"Consul Service Discovery")),(0,a.yg)("li",{parentName:"ul"},"Fill in the basic configuration parameters"))),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"Configure Monitoring Template")),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"After creating the service discovery monitoring, you need to specify a monitoring template"),(0,a.yg)("li",{parentName:"ul"},"The template defines what type of monitoring to create for discovered service instances"),(0,a.yg)("li",{parentName:"ul"},"For example: If discovered instances are HTTP services, you can select HTTP monitoring template"),(0,a.yg)("li",{parentName:"ul"},"Common template types: Port, HTTP, HTTPS, Ping, etc."))),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"Automatic Discovery")),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"HertzBeat will periodically query Consul server based on the collection interval"),(0,a.yg)("li",{parentName:"ul"},"Automatically create monitoring tasks for newly registered service instances"),(0,a.yg)("li",{parentName:"ul"},"Automatically delete monitoring tasks for offline service instances"))),(0,a.yg)("li",{parentName:"ol"},(0,a.yg)("p",{parentName:"li"},(0,a.yg)("strong",{parentName:"p"},"View Discovered Instances")),(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},"In the monitoring list, you can see all automatically created sub-monitoring tasks"),(0,a.yg)("li",{parentName:"ul"},"Each sub-monitoring task corresponds to a discovered service instance")))),(0,a.yg)("h3",{id:"example-of-usage"},"Example of usage"),(0,a.yg)("p",null,"Suppose your Consul server is running at ",(0,a.yg)("inlineCode",{parentName:"p"},"192.168.1.100:8500"),", and you want to automatically monitor all service instances registered in it."),(0,a.yg)("p",null,"Configuration example:"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Target Name"),": ",(0,a.yg)("inlineCode",{parentName:"li"},"Consul-Service-Discovery")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Consul Host"),": ",(0,a.yg)("inlineCode",{parentName:"li"},"192.168.1.100")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Consul Port"),": ",(0,a.yg)("inlineCode",{parentName:"li"},"8500")),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Collection interval"),": ",(0,a.yg)("inlineCode",{parentName:"li"},"60")," seconds"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Monitoring Template"),": Select ",(0,a.yg)("inlineCode",{parentName:"li"},"Port")," monitoring (to detect instance availability)")),(0,a.yg)("p",null,"After configuration:"),(0,a.yg)("ol",null,(0,a.yg)("li",{parentName:"ol"},"HertzBeat connects to Consul server via HTTP API"),(0,a.yg)("li",{parentName:"ol"},"Retrieves all registered service instances"),(0,a.yg)("li",{parentName:"ol"},"Automatically creates Port monitoring for each instance (e.g., ",(0,a.yg)("inlineCode",{parentName:"li"},"api-service-192.168.1.101:8080"),")"),(0,a.yg)("li",{parentName:"ol"},"Every 60 seconds, checks for newly registered or offline services and updates monitoring tasks accordingly")),(0,a.yg)("h3",{id:"notes"},"Notes"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Network Connectivity"),": Ensure HertzBeat can access the Consul server address and port (default: 8500)"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Monitoring Templates"),": Service discovery only discovers service instance addresses, you need to configure appropriate monitoring templates to actually monitor the instances"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Collection Interval"),": Recommended minimum interval is 60 seconds to avoid excessive requests to Consul server"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"ACL Token"),": If Consul is configured with ACL (Access Control List), you may need to configure the appropriate token"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Health"),": Consul service discovery will discover both healthy and unhealthy instances"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Datacenter"),": By default, discovers services in the local datacenter. If you need to discover services in a specific datacenter, additional configuration may be required"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Instance Naming"),": Automatically created monitoring tasks are named in the format: ",(0,a.yg)("inlineCode",{parentName:"li"},"{ServiceName}-{Host}:{Port}"))),(0,a.yg)("h3",{id:"collection-metric"},"Collection Metric"),(0,a.yg)("h4",{id:"metric-set-monitor-target"},"Metric set: Monitor Target"),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"Metric name"),(0,a.yg)("th",{parentName:"tr",align:null},"Metric unit"),(0,a.yg)("th",{parentName:"tr",align:null},"Metric help description"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"target"),(0,a.yg)("td",{parentName:"tr",align:null},"none"),(0,a.yg)("td",{parentName:"tr",align:null},"Discovered service instance target")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"host"),(0,a.yg)("td",{parentName:"tr",align:null},"none"),(0,a.yg)("td",{parentName:"tr",align:null},"Service instance host address")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"port"),(0,a.yg)("td",{parentName:"tr",align:null},"none"),(0,a.yg)("td",{parentName:"tr",align:null},"Service instance port number")))),(0,a.yg)("h3",{id:"use-cases"},"Use Cases"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Microservice Architecture"),": Automatically monitor all microservice instances registered in Consul"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Mesh"),": Monitor services using Consul Connect service mesh"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Multi-Datacenter"),": Monitor service instances across multiple Consul datacenters"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Dynamic Scaling"),": Automatically adapt to service instances added/removed due to autoscaling"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Health Check"),": Combine with Consul's health check mechanism to monitor service health status"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Governance"),": Centrally manage monitoring of all services in the Consul service ecosystem")),(0,a.yg)("h3",{id:"integration-with-consul-features"},"Integration with Consul Features"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Health"),": Consul service discovery can leverage Consul's health check information"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Tags"),": Service instances discovered from Consul may include tag information"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"KV Storage"),": Can be used in conjunction with Consul KV storage to achieve more flexible service discovery"),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("strong",{parentName:"li"},"Service Mesh"),": Supports service discovery in Consul Connect service mesh environment")))}u.isMDXComponent=!0}}]);