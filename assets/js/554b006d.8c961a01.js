"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[26809],{45906:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>i});var t=n(30758);const r={},s=t.createContext(r);function o(e){const a=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:a},e.children)}},77311:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"start/mysql-change","title":"Use MYSQL Replace H2 Database to Store Metadata(Optional)","description":"MYSQL is a reliable relational database. In addition to default built-in H2 database, Apache HertzBeat\u2122 allow you to use MYSQL to store structured relational data such as monitoring information, alarm information and configuration information.","source":"@site/docs/start/mysql-change.md","sourceDirName":"start","slug":"/start/mysql-change","permalink":"/docs/next/start/mysql-change","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/docs/start/mysql-change.md","tags":[],"version":"current","frontMatter":{"id":"mysql-change","title":"Use MYSQL Replace H2 Database to Store Metadata(Optional)","sidebar_label":"Meta Store MYSQL"},"sidebar":"docs","previous":{"title":"Meta Store PostgreSQL (Recommended)","permalink":"/docs/next/start/postgresql-change"},"next":{"title":"SSL Certificate Monitoring Practice","permalink":"/docs/next/start/usecase/ssl-cert-practice"}}');var r=n(86070),s=n(45906);const o={id:"mysql-change",title:"Use MYSQL Replace H2 Database to Store Metadata(Optional)",sidebar_label:"Meta Store MYSQL"},i=void 0,l={},c=[{value:"Supported MySQL Versions",id:"supported-mysql-versions",level:3},{value:"Install MYSQL via Docker",id:"install-mysql-via-docker",level:3},{value:"Database creation",id:"database-creation",level:3},{value:"Add MYSQL jdbc driver jar",id:"add-mysql-jdbc-driver-jar",level:3},{value:"Modify hertzbeat&#39;s configuration file application.yml and switch data source",id:"modify-hertzbeats-configuration-file-applicationyml-and-switch-data-source",level:3}];function d(e){const a={a:"a",blockquote:"blockquote",br:"br",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.p,{children:"MYSQL is a reliable relational database. In addition to default built-in H2 database, Apache HertzBeat\u2122 allow you to use MYSQL to store structured relational data such as monitoring information, alarm information and configuration information."}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsx)(a.p,{children:"If you already have a MySQL environment and the MySQL version meets the requirements, you can skip directly to the database creation step."}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"supported-mysql-versions",children:"Supported MySQL Versions"}),"\n",(0,r.jsx)(a.p,{children:"Please ensure you are using a supported MySQL version. HertzBeat only supports MySQL 5.7+ or 8 versions. You can check the MySQL version with the following command:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-shell",children:"$ mysql --version\nmysql  Ver 8.0.25 for Linux on x86_64 (MySQL Community Server - GPL)\n"})}),"\n",(0,r.jsx)(a.h3,{id:"install-mysql-via-docker",children:"Install MYSQL via Docker"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Download and install the Docker environment\nFor Docker installation, please refer to the ",(0,r.jsx)(a.a,{href:"https://docs.docker.com/get-docker/",children:"Docker official documentation"}),".\nAfter the installation, please verify in the terminal that the Docker version can be printed normally."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-shell",children:"$ docker -v\nDocker version 20.10.12, build e91ed57\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsx)(a.p,{children:"Install MYSQl with Docker"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-shell",children:"$ docker run -d --name mysql \\\n -p 3306:3306 \\\n-v /opt/data:/var/lib/mysql \\\n-e MYSQL_ROOT_PASSWORD=123456 \\\n--restart=always \\\nmysql:5.7\n"})}),"\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.code,{children:"-v /opt/data:/var/lib/mysql"})," is local persistent mount of mysql data directory. ",(0,r.jsx)(a.code,{children:"/opt/data"})," should be replaced with the actual local directory.\nuse ",(0,r.jsx)(a.code,{children:"$ docker ps"})," to check if the database started successfully"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"database-creation",children:"Database creation"}),"\n",(0,r.jsxs)(a.ol,{children:["\n",(0,r.jsxs)(a.li,{children:["Enter MYSQL or use the client to connect MYSQL service\n",(0,r.jsx)(a.code,{children:"mysql -uroot -p123456"})]}),"\n",(0,r.jsxs)(a.li,{children:["Create database named hertzbeat\n",(0,r.jsx)(a.code,{children:"create database hertzbeat default charset utf8mb4 collate utf8mb4_general_ci;"})]}),"\n",(0,r.jsxs)(a.li,{children:["Check if hertzbeat database has been successfully created\n",(0,r.jsx)(a.code,{children:"show databases;"})]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"add-mysql-jdbc-driver-jar",children:"Add MYSQL jdbc driver jar"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["Download the MYSQL jdbc driver jar package, such as mysql-connector-java-8.0.25.jar. ",(0,r.jsx)(a.a,{href:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip",children:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip"})]}),"\n",(0,r.jsxs)(a.li,{children:["Copy the jar package to the ",(0,r.jsx)(a.code,{children:"hertzbeat/ext-lib"})," directory."]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"modify-hertzbeats-configuration-file-applicationyml-and-switch-data-source",children:"Modify hertzbeat's configuration file application.yml and switch data source"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:["Configure HertzBeat's configuration file",(0,r.jsx)(a.br,{}),"\n","Modify ",(0,r.jsx)(a.code,{children:"hertzbeat/config/application.yml"})," configuration file",(0,r.jsx)(a.br,{}),"\n","Note\u26a0\ufe0fThe docker container way need to mount application.yml file locally, while you can use installation package way to unzip and modify ",(0,r.jsx)(a.code,{children:"hertzbeat/config/application.yml"}),(0,r.jsx)(a.br,{}),"\n","Replace ",(0,r.jsx)(a.code,{children:"spring.database"})," data source parameters, URL account and password."]}),"\n",(0,r.jsx)(a.p,{children:"For example:"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"spring:\n  datasource:\n    driver-class-name: org.h2.Driver\n    username: sa\n    password: 123456\n    url: jdbc:h2:./data/hertzbeat;MODE=MYSQL\n    hikari:\n      max-lifetime: 120000\n\n  jpa:\n    show-sql: false\n    database-platform: org.eclipse.persistence.platform.database.MySQLPlatform\n    database: h2\n    properties:\n      eclipselink:\n        logging:\n          level: SEVERE\n"})}),"\n",(0,r.jsx)(a.p,{children:"Specific replacement parameters are as follows and you need to configure account according to the mysql environment:"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"spring:\n  datasource:\n    driver-class-name: com.mysql.cj.jdbc.Driver\n    username: root\n    password: 123456\n    url: jdbc:mysql://mysql:3306/hertzbeat?useUnicode=true&characterEncoding=utf-8&allowPublicKeyRetrieval=true&useSSL=false\n    hikari:\n      max-lifetime: 120000\n  jpa:\n    show-sql: false\n    database-platform: org.eclipse.persistence.platform.database.MySQLPlatform\n    database: mysql\n    properties:\n      eclipselink:\n        logging:\n          level: SEVERE\n"})}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:"It is recommended to set the host field in the MySQL URL to the public IP address when using Hertzbeat in docker."}),"\n"]}),"\n",(0,r.jsxs)(a.blockquote,{children:["\n",(0,r.jsxs)(a.p,{children:["Note: The above applies to the method of downloading and installing the package. For local data source switching, simply complete the ",(0,r.jsx)(a.a,{href:"./mysql-change#database-creation",children:"Database creation"})," and modify the configuration in ",(0,r.jsx)(a.code,{children:"hertzbeat-startup/src/main/resources/application.yml"}),"."]}),"\n"]}),"\n",(0,r.jsx)(a.p,{children:(0,r.jsxs)(a.strong,{children:["Start HertzBeat  visit ",(0,r.jsx)(a.a,{href:"http://ip:1157/",children:"http://ip:1157/"})," on the browser  You can use HertzBeat monitoring alarm, default account and password are admin/hertzbeat"]})})]})}function h(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);