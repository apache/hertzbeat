"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[87993],{11563:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"help/spark","title":"Monitoring Spark","description":"Collect and monitor the general performance Metrics of Spark.","source":"@site/versioned_docs/version-1.7.x/help/spark.md","sourceDirName":"help","slug":"/help/spark","permalink":"/docs/help/spark","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-1.7.x/help/spark.md","tags":[],"version":"1.7.x","frontMatter":{"id":"spark","title":"Monitoring Spark","sidebar_label":"Spark Monitor","keywords":["open source monitoring tool","open source java spark monitoring tool","monitoring spark metrics"]},"sidebar":"docs","previous":{"title":"SeaTunnel","permalink":"/docs/help/seatunnel"},"next":{"title":"Apache Yarn","permalink":"/docs/help/yarn"}}');var s=r(86070),i=r(45906);const o={id:"spark",title:"Monitoring Spark",sidebar_label:"Spark Monitor",keywords:["open source monitoring tool","open source java spark monitoring tool","monitoring spark metrics"]},d=void 0,c={},a=[{value:"Spark App Enable JMX Protocol",id:"spark-app-enable-jmx-protocol",level:3},{value:"First step",id:"first-step",level:2},{value:"The second step",id:"the-second-step",level:2},{value:"The third step",id:"the-third-step",level:2},{value:"Configuration parameter",id:"configuration-parameter",level:3},{value:"Collection Metrics",id:"collection-metrics",level:3},{value:"Metrics Set\uff1amemory_pool",id:"metrics-setmemory_pool",level:4},{value:"Metrics Set\uff1acode_cache (Only Support JDK8)",id:"metrics-setcode_cache-only-support-jdk8",level:4},{value:"Metrics Set\uff1aclass_loading",id:"metrics-setclass_loading",level:4},{value:"Metrics Set\uff1athread",id:"metrics-setthread",level:4}];function l(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsx)(t.p,{children:"Collect and monitor the general performance Metrics of Spark."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Protocol Use\uff1aJMX"})}),"\n",(0,s.jsx)(t.h3,{id:"spark-app-enable-jmx-protocol",children:"Spark App Enable JMX Protocol"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Add Spark ",(0,s.jsx)(t.code,{children:"VM options"})," When Start Server \u26a0\ufe0f customIP"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["Refer: ",(0,s.jsx)(t.a,{href:"https://spark.apache.org/docs/latest/spark-standalone.html",children:"https://spark.apache.org/docs/latest/spark-standalone.html"})]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Monitoring configuration spark can be monitored by Master, Worker, driver, and executor. The Master and Worker can be monitored when the spark cluster is running, while the Driver and Excutor need to be monitored for an app."}),"\n",(0,s.jsx)(t.strong,{children:"If you want to monitor them, perform the following steps to configure them"})]}),"\n",(0,s.jsx)(t.h2,{id:"first-step",children:"First step"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Modify $SPARK_HOME/conf/spark-env.sh to add the following statement:"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:'# JMX Port to use\nSPARK_DAEMON_JAVA_OPTS="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false" \n\n# export SPARK_DAEMON_JAVA_OPTS="$SPARK_DAEMON_JAVA_OPTS -Dcom.sun.management.jmxremote.port=$JMX_PORT "\nexport SPARK_DAEMON_JAVA_OPTS="-Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=8712 "\n'})}),"\n",(0,s.jsx)(t.p,{children:"The statement contains $JMX_PORT, the value of which can be customized, or a random number can be obtained as the port number.\nIf the port is customized to a specific value, and the spark Master and one of the workers are on the same machine, a port conflict will occur."}),"\n",(0,s.jsx)(t.h2,{id:"the-second-step",children:"The second step"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"vim $SPARK_HOME/conf/metrics.properties to add the following statement:"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"*.sink.jmx.class=org.apache.spark.metrics.sink.JmxSink\nmaster.source.jvm.class=org.apache.spark.metrics.source.JvmSource\nworker.source.jvm.class=org.apache.spark.metrics.source.JvmSource\ndriver.source.jvm.class=org.apache.spark.metrics.source.JvmSource\nexecutor.source.jvm.class=org.apache.spark.metrics.source.JvmSource\n"})}),"\n",(0,s.jsx)(t.h2,{id:"the-third-step",children:"The third step"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"vim $SPARK_HOME/conf/spark-defaults.conf, add the following items to set the monitoring port for the driver and executor. This port will be opened when programs are running."})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"spark.metrics.conf /opt/bigdata/spark/conf/metrics.properties\nspark.driver.extraJavaOptions -XX:+PrintGCDetails -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.mana\ngement.jmxremote.port=8712\n\nspark.executor.extraJavaOptions -XX:+PrintGCDetails -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.mana\ngement.jmxremote.port=8711\n"})}),"\n",(0,s.jsx)(t.p,{children:"With spark's Master and Worker running properly and spark-Submit submitting a program, the port number can be queried from linux."}),"\n",(0,s.jsx)(t.h3,{id:"configuration-parameter",children:"Configuration parameter"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Parameter name"}),(0,s.jsx)(t.th,{children:"Parameter help description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Monitoring Host"}),(0,s.jsx)(t.td,{children:"Monitored IPV4, IPV6 or domain name. Note\u26a0\ufe0fWithout protocol header (eg: https://, http://)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Monitoring name"}),(0,s.jsx)(t.td,{children:"Identify the name of this monitoring. The name needs to be unique"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Port"}),(0,s.jsx)(t.td,{children:"Port provided by JMX"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Username"}),(0,s.jsx)(t.td,{children:"JMX connection user name, optional"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Password"}),(0,s.jsx)(t.td,{children:"JMX connection password, optional"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Collection interval"}),(0,s.jsx)(t.td,{children:"Interval time of monitor periodic data collection, unit: second, and the minimum interval that can be set is 30 seconds"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Whether to detect"}),(0,s.jsx)(t.td,{children:"Whether to detect and check the availability of monitoring before adding monitoring. Adding and modifying operations will continue only after the detection is successful"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Description remarks"}),(0,s.jsx)(t.td,{children:"For more information about identifying and describing this monitoring, users can note information here"})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"collection-metrics",children:"Collection Metrics"}),"\n",(0,s.jsx)(t.h4,{id:"metrics-setmemory_pool",children:"Metrics Set\uff1amemory_pool"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Metric name"}),(0,s.jsx)(t.th,{children:"Metric unit"}),(0,s.jsx)(t.th,{children:"Metric help description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"name"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"metrics name"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"committed"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"total size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"init"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"init size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"max"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"max size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"used"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"used size"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"metrics-setcode_cache-only-support-jdk8",children:"Metrics Set\uff1acode_cache (Only Support JDK8)"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Metric name"}),(0,s.jsx)(t.th,{children:"Metric unit"}),(0,s.jsx)(t.th,{children:"Metric help description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"committed"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"total size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"init"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"init size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"max"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"max size"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"used"}),(0,s.jsx)(t.td,{children:"kb"}),(0,s.jsx)(t.td,{children:"used size"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"metrics-setclass_loading",children:"Metrics Set\uff1aclass_loading"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Metric name"}),(0,s.jsx)(t.th,{children:"Metric unit"}),(0,s.jsx)(t.th,{children:"Metric help description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"LoadedClassCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Loaded Class Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"TotalLoadedClassCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Total Loaded Class Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"UnloadedClassCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Unloaded Class Count"})]})]})]}),"\n",(0,s.jsx)(t.h4,{id:"metrics-setthread",children:"Metrics Set\uff1athread"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Metric name"}),(0,s.jsx)(t.th,{children:"Metric unit"}),(0,s.jsx)(t.th,{children:"Metric help description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"TotalStartedThreadCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Total Started Thread Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"ThreadCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Thread Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"PeakThreadCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Peak Thread Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"DaemonThreadCount"}),(0,s.jsx)(t.td,{}),(0,s.jsx)(t.td,{children:"Daemon Thread Count"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"CurrentThreadUserTime"}),(0,s.jsx)(t.td,{children:"ms"}),(0,s.jsx)(t.td,{children:"Current Thread User Time"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"CurrentThreadCpuTime"}),(0,s.jsx)(t.td,{children:"ms"}),(0,s.jsx)(t.td,{children:"Current Thread Cpu Time"})]})]})]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},45906:(e,t,r)=>{r.d(t,{R:()=>o,x:()=>d});var n=r(30758);const s={},i=n.createContext(s);function o(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);