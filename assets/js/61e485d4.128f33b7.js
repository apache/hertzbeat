"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[95030],{99981(e,a,t){t.r(a),t.d(a,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>n,toc:()=>o});var n=t(63966),r=t(86070),s=t(60056);const d={},i="HertzBeat Upgrade Guide (Docker Mode)",l={authorsImageUrls:[]},o=[{value:"Docker-based Upgrade",id:"docker-based-upgrade",level:2},{value:"1. Data Backup",id:"1-data-backup",level:3},{value:"2. Stop and Remove the HertzBeat Container",id:"2-stop-and-remove-the-hertzbeat-container",level:3},{value:"3. Upgrade Database Schema",id:"3-upgrade-database-schema",level:3},{value:"4. Restart HertzBeat with the New Image",id:"4-restart-hertzbeat-with-the-new-image",level:3},{value:"5. Update Configuration Files",id:"5-update-configuration-files",level:3},{value:"6. Add Database Drivers",id:"6-add-database-drivers",level:3}];function c(e){const a={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.h2,{id:"docker-based-upgrade",children:"Docker-based Upgrade"}),"\n",(0,r.jsx)(a.h3,{id:"1-data-backup",children:"1. Data Backup"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"Back up the database"}),": Manually back up MySQL data as needed."]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:'mysqldump -h<HOST-IP> -P`<PORT>` -uroot -p"PASSWORD" `<DB_NAME>` > hertzbeat_backup-`date +%Y-%m-%d`.sql  # Single database  \nmysqldump -h<HOST-IP> -P`<PORT>` -uroot -p"PASSWORD" --all-databases > hertzbeat_backup-`date +%Y-%m-%d`.sql  # Full database  \n'})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:"Back up configuration files and data directory"}),":"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"mv application.yml application-bak.yml && mv sureness.yml sureness-bak.yml  \ncp -R data data-`date +%Y-%m-%d`.bak  \n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"2-stop-and-remove-the-hertzbeat-container",children:"2. Stop and Remove the HertzBeat Container"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker stop hertzbeat && docker rm hertzbeat  \n"})}),"\n",(0,r.jsx)(a.h3,{id:"3-upgrade-database-schema",children:"3. Upgrade Database Schema"}),"\n",(0,r.jsxs)(a.p,{children:["Navigate to ",(0,r.jsx)(a.a,{href:"https://github.com/apache/hertzbeat/tree/master/hertzbeat-startup/src/main/resources/db/migration",children:"HertzBeat GitHub Migration Scripts"}),", select the appropriate ",(0,r.jsx)(a.code,{children:"V160__update_column.sql"})," file under your database type (e.g., MySQL), and execute it in MySQL."]}),"\n",(0,r.jsx)(a.h3,{id:"4-restart-hertzbeat-with-the-new-image",children:"4. Restart HertzBeat with the New Image"}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-bash",children:"docker run -d -p 1157:1157 -p 1158:1158 \\  \n    -v $(pwd)/data:/opt/hertzbeat/data \\  \n    -v $(pwd)/logs:/opt/hertzbeat/logs \\  \n    -v $(pwd)/application.yml:/opt/hertzbeat/config/application.yml \\  \n    -v $(pwd)/sureness.yml:/opt/hertzbeat/config/sureness.yml \\  \n    --restart=always \\  \n    --name hertzbeat apache/hertzbeat:v1.7.0  \n"})}),"\n",(0,r.jsx)(a.h3,{id:"5-update-configuration-files",children:"5. Update Configuration Files"}),"\n",(0,r.jsx)(a.p,{children:"Modify the backup configurations as needed:"}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:(0,r.jsx)(a.code,{children:"application.yml"})})," (Typical modifications):"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"datasource:\n  driver-class-name: com.mysql.cj.jdbc.Driver\n  username: root\n  password: root\n  url: jdbc:mysql://localhost:3306/hertzbeat?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai\n  hikari:\n    max-lifetime: 120000\n\njpa:\n  show-sql: false\n  database-platform: org.eclipse.persistence.platform.database.MySQLPlatform\n  database: mysql\n  properties:\n    eclipselink:\n      logging:\n        level: SEVERE\n"})}),"\n"]}),"\n",(0,r.jsxs)(a.li,{children:["\n",(0,r.jsxs)(a.p,{children:[(0,r.jsx)(a.strong,{children:(0,r.jsx)(a.code,{children:"sureness.yml"})})," (Optional, modify for account/password changes):"]}),"\n",(0,r.jsx)(a.pre,{children:(0,r.jsx)(a.code,{className:"language-yaml",children:"account:\n  - appId: admin\n    credential: hertzbeat\n    role: [admin]\n  - appId: tom\n    credential: hertzbeat\n    role: [user]\n  - appId: guest\n    credential: hertzbeat\n    role: [guest]\n  - appId: lili\n    credential: 94C6B34E7A199A9F9D4E1F208093B489\n    salt: 123\n    role: [user]\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(a.h3,{id:"6-add-database-drivers",children:"6. Add Database Drivers"}),"\n",(0,r.jsxs)(a.p,{children:["Due to Apache Foundation\u2019s license compliance requirements, HertzBeat cannot include GPL-licensed dependencies (e.g., MySQL, Oracle). Users must manually download drivers and place them in the ",(0,r.jsx)(a.code,{children:"ext-lib"})," directory, then mount it to ",(0,r.jsx)(a.code,{children:"/opt/hertzbeat/ext-lib"}),":"]}),"\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"MySQL Driver"}),": ",(0,r.jsx)(a.a,{href:"https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-8.0.25.zip",children:"Download MySQL Connector/J 8.0.25"})]}),"\n",(0,r.jsxs)(a.li,{children:[(0,r.jsx)(a.strong,{children:"Oracle Driver"})," (Required for Oracle monitoring):","\n",(0,r.jsxs)(a.ul,{children:["\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"https://download.oracle.com/otn-pub/otn_software/jdbc/234/ojdbc8.jar",children:"ojdbc8.jar"})}),"\n",(0,r.jsx)(a.li,{children:(0,r.jsx)(a.a,{href:"https://repo.mavenlibs.com/maven/com/oracle/database/nls/orai18n/21.5.0.0/orai18n-21.5.0.0.jar",children:"orai18n-21.5.0.0.jar"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:a}={...(0,s.R)(),...e.components};return a?(0,r.jsx)(a,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},60056(e,a,t){t.d(a,{R:()=>d,x:()=>i});var n=t(30758);const r={},s=n.createContext(r);function d(e){const a=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function i(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),n.createElement(s.Provider,{value:a},e.children)}},63966(e){e.exports=JSON.parse('{"permalink":"/blog/2025/04/23/hertzbeat-upgrade-guide-docker-mode","editUrl":"https://github.com/apache/hertzbeat/edit/master/home/blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md","source":"@site/blog/2025-04-23-hertzbeat-upgrade-guide-docker-mode.md","title":"HertzBeat Upgrade Guide (Docker Mode)","description":"Docker-based Upgrade","date":"2025-04-23T00:00:00.000Z","tags":[],"readingTime":1.82,"hasTruncateMarker":false,"authors":[],"frontMatter":{},"unlisted":false,"prevItem":{"title":"From User to PPMC Member: Contributing to Open Source with Passion at Apache HertzBeat","permalink":"/blog/2025/5/19/new-pmc"},"nextItem":{"title":"HertzBeat Upgrade Guide from v1.6.1 to v1.7.0 (Helm Mode)","permalink":"/blog/2025/04/23/hertzbeat-upgrade-guide-from-v1.6.1-to-v1.7.0-helm-mode"}}')}}]);