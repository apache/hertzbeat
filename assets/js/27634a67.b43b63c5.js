"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[83891],{56726(e,n,t){t.r(n),t.d(n,{assets:()=>h,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var i=t(88773),o=t(86070),r=t(60056);const s={title:"HertzBeat's Monitoring Practice for API Gateway Apache ShenYu",author:"tom",author_title:"tom",author_url:"https://github.com/tomsun28",tags:["opensource","practice"]},a=void 0,h={authorsImageUrls:[void 0]},l=[{value:"Monitoring practice for API gateway Apache ShenYu using HertzBeat, 5 minutes",id:"monitoring-practice-for-api-gateway-apache-shenyu-using-hertzbeat-5-minutes",level:3},{value:"Introduction to Apache ShenYu",id:"introduction-to-apache-shenyu",level:3},{value:"HertzBeat Introduction",id:"hertzbeat-introduction",level:3},{value:"Monitor Apache ShenYu in HertzBeat in 5 minutes",id:"monitor-apache-shenyu-in-hertzbeat-in-5-minutes",level:3},{value:"You must have a ShenYu environment and a HertzBeat environment",id:"you-must-have-a-shenyu-environment-and-a-hertzbeat-environment",level:4},{value:"i. Enable the <code>metrics</code> plugin on the ShenYu side, which will provide the metrics interface data",id:"i-enable-the-metrics-plugin-on-the-shenyu-side-which-will-provide-the-metrics-interface-data",level:4},{value:"ii. Adding ShenYu Monitor in HertzBeat Monitor Page",id:"ii-adding-shenyu-monitor-in-hertzbeat-monitor-page",level:4},{value:"III. Adding ShenYu Metrics Threshold Alerts to the HertzBeat System",id:"iii-adding-shenyu-metrics-threshold-alerts-to-the-hertzbeat-system",level:4},{value:"Over and out, now wait for the alert message to come through. Ding, ding, ding, ding",id:"over-and-out-now-wait-for-the-alert-message-to-come-through-ding-ding-ding-ding",level:3},{value:"Summary",id:"summary",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"monitoring-practice-for-api-gateway-apache-shenyu-using-hertzbeat-5-minutes",children:"Monitoring practice for API gateway Apache ShenYu using HertzBeat, 5 minutes"}),"\n",(0,o.jsx)(n.h3,{id:"introduction-to-apache-shenyu",children:"Introduction to Apache ShenYu"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Apache ShenYu is an asynchronous, high-performance, cross-language, responsive API gateway."}),"\n"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Proxy: supports Apache Dubbo, Spring Cloud, gRPC, Motan, SOFA, TARS, WebSocket, MQTT."}),"\n",(0,o.jsx)(n.li,{children:"Security: Signature, OAuth 2.0, JSON Web Token, WAF Plugin"}),"\n",(0,o.jsx)(n.li,{children:"API Governance: Request, Response, Parameter Mapping, Hystrix, RateLimiter Plugin"}),"\n",(0,o.jsx)(n.li,{children:"Observability: tracing, metrics, logging plug-ins"}),"\n",(0,o.jsx)(n.li,{children:"Dashboard: dynamic flow control, visual backend for user menu permissions"}),"\n",(0,o.jsx)(n.li,{children:"Extension: plugin hot-plugging, dynamic loading"}),"\n",(0,o.jsx)(n.li,{children:"Clustering: NGINX, Docker, Kubernetes"}),"\n",(0,o.jsx)(n.li,{children:"Languages: .NET, Python, Go, Java clients available for API registration"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"hertzbeat-introduction",children:"HertzBeat Introduction"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"HertzBeat is an open source, easy to use and friendly real-time monitoring tool, no Agent, with powerful custom monitoring capabilities.\nSupport for application services, database, operating system, middleware, cloud native monitoring, threshold alarms, alarm notification (email WeChat Nail Flybook).\nHertzBeat's powerful customization, multi-type support, easy to extend, low-coupling, hope to help developers and small and medium-sized teams to quickly build their own monitoring system."}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"monitor-apache-shenyu-in-hertzbeat-in-5-minutes",children:"Monitor Apache ShenYu in HertzBeat in 5 minutes"}),"\n",(0,o.jsx)(n.h4,{id:"you-must-have-a-shenyu-environment-and-a-hertzbeat-environment",children:"You must have a ShenYu environment and a HertzBeat environment"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["ShenYu ",(0,o.jsx)(n.a,{href:"https://shenyu.apache.org/zh/docs/deployment/deployment-before",children:"Deployment and Installation Documentation"})]}),"\n",(0,o.jsxs)(n.li,{children:["HertzBeat ",(0,o.jsx)(n.a,{href:"https://hertzbeat.apache.org/docs/start/docker-deploy",children:"Deployment and Installation Documentation"})]}),"\n"]}),"\n",(0,o.jsxs)(n.h4,{id:"i-enable-the-metrics-plugin-on-the-shenyu-side-which-will-provide-the-metrics-interface-data",children:["i. Enable the ",(0,o.jsx)(n.code,{children:"metrics"})," plugin on the ShenYu side, which will provide the metrics interface data"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["The plugin is the core implementer of the Apache ShenYu gateway, and metrics data collection is also integrated at ",(0,o.jsx)(n.code,{children:"ShenYu"})," in the form of a plugin - ",(0,o.jsx)(n.code,{children:"Metrics Plugin"}),".\nThe ",(0,o.jsx)(n.code,{children:"Metrics plugin"})," is used by the gateway to monitor its own operational status (",(0,o.jsx)(n.code,{children:"JVM"})," related), request responses and other related metrics."]}),"\n"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the ",(0,o.jsx)(n.code,{children:"metrics plugin"})," dependency to the ",(0,o.jsx)(n.code,{children:"pom.xml"})," file of the gateway."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",children:"`<dependency>`\n    `<groupId>`org.apache.shenyu`</groupId>`\n    `<artifactId>`shenyu-spring-boot-starter-plugin-metrics`</artifactId>`\n    `<version>`${project.version}`</version>`\n`</dependency>`\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"metric"})," plugin Capture is turned off by default, edit the following in the gateway's configuration ",(0,o.jsx)(n.code,{children:"yaml"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"shenyu:\n  metrics:\n    enabled: true #Set to true to enable\n    name: prometheus \n    host: 127.0.0.1 #exposed ip\n    port: 8090 #Exposed port\n    jmxConfig: #jmx configuration\n    props: #jvm_enabled: true\n      jvm_enabled: true #Enable monitoring metrics for jvm\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Restart ShenYu Gateway, open a browser or use curl to access ",(0,o.jsx)(n.code,{children:"http://ip:8090"}),", you can see the metric data."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"ii-adding-shenyu-monitor-in-hertzbeat-monitor-page",children:"ii. Adding ShenYu Monitor in HertzBeat Monitor Page"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Click Add ShenYu Monitor"}),"\n",(0,o.jsx)(n.p,{children:"Path: Menu -> Middleware Monitor -> ShenYu Monitor -> Add ShenYu Monitor"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(45212).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Configure the parameters required for monitoring ShenYu"}),"\n",(0,o.jsxs)(n.p,{children:["On the monitor page, fill in ShenYu ",(0,o.jsx)(n.strong,{children:"service IP"}),", ",(0,o.jsx)(n.strong,{children:"monitor port"})," (default 8090), and click OK to add.\nFor other parameters such as ",(0,o.jsx)(n.strong,{children:"collection interval"}),", ",(0,o.jsx)(n.strong,{children:"timeout"}),", etc., you can refer to the ",(0,o.jsx)(n.a,{href:"https://hertzbeat.apache.org/docs/help/shenyu/",children:"help file"})," ",(0,o.jsx)(n.a,{href:"https://hertzbeat.apache.org/docs/help/shenyu/",children:"https://hertzbeat.apache.org/docs/help/shenyu/"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(45212).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Done \u2705, now we have added monitoring for ShenYu, check the monitor list to see our additions."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(57742).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Click ",(0,o.jsx)(n.strong,{children:"Options"}),"->",(0,o.jsx)(n.strong,{children:"Monitoring Details icon"})," in the monitor list to view ShenYu's real-time monitoring metrics."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(75457).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Click the ",(0,o.jsx)(n.strong,{children:"Monitor History TAB"})," to view ShenYu's historical monitoring metrics graphs \ud83d\udcc8."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(54328).A+"",width:"4064",height:"2166"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(83).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"DONE! With the above steps, it's really only two steps"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["The first step is to enable the ",(0,o.jsx)(n.code,{children:"metrics"})," plugin on the ShenYu side"]}),"."]}),"\n",(0,o.jsx)(n.li,{children:"**The second step is to configure the IP ports on the HertzBeat monitoring page to add monitoring"}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"By the above two steps we have finished monitoring Apache ShenYu, we can check the monitoring details and metrics information in HertzBeat anytime to observe its service status.\nOf course, just looking at it is not perfect, monitoring is often accompanied by alarm thresholds, when some of ShenYu's indicators exceed our expectations or abnormalities, we can promptly notify the person in charge of our counterparts, the person in charge of the notification to deal with the problem, so that is a complete monitoring and alerting process."})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Next we will demonstrate step by step how to configure the threshold alarm notification in HertzBeat system, so that when ShenYu's metrics are abnormal, we will be notified in a timely manner"})," **This is a complete monitoring and alerting process."]}),"\n",(0,o.jsx)(n.h4,{id:"iii-adding-shenyu-metrics-threshold-alerts-to-the-hertzbeat-system",children:"III. Adding ShenYu Metrics Threshold Alerts to the HertzBeat System"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Configure an alarm threshold for an important metric."}),"\n",(0,o.jsx)(n.p,{children:"Path: Menu -> Alert Thresholds -> Add Thresholds"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["There are a lot of metrics in ShenYu monitoring, for example, we will set the threshold for the ",(0,o.jsx)(n.code,{children:"number of open file descriptors"})," ",(0,o.jsx)(n.code,{children:"process_open_fds"})," -> ",(0,o.jsx)(n.code,{children:"value"})," metric, which will alert you when the number of open file descriptors on the server side is greater than 3,000."]}),"\n",(0,o.jsxs)(n.li,{children:["Here we configure an alert to be issued when the ",(0,o.jsx)(n.code,{children:"value' of"}),"process_open_fds` exceeds 3000, with an alert level of ",(0,o.jsx)(n.strong,{children:"Warning alert"}),", which is triggered three times, as shown in the following figure."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(61226).A+"",width:"4064",height:"2166"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Add message notification recipients"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Configure recipients to let alert message know who to send to and in what way."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Path: Menu -> Alert Notification -> Alert Recipients -> Add New Recipient."}),"\n",(0,o.jsxs)(n.p,{children:["Message notification methods support ",(0,o.jsx)(n.strong,{children:"Email, Nail, WeChat, Flybook, WebHook, SMS"}),", etc. Here we take the commonly used Nail as an example."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Refer to this ",(0,o.jsx)(n.a,{href:"https://hertzbeat.apache.org/docs/help/alert_dingtalk",children:"help document"})," ",(0,o.jsx)(n.a,{href:"https://hertzbeat.apache.org/docs/help/alert_dingtalk",children:"https://hertzbeat.apache.org/docs/help/alert_dingtalk"})," Configure the bot on the pinning side, set the security customization keyword ",(0,o.jsx)(n.code,{children:"HertzBeat"}),", get the corresponding ",(0,o.jsx)(n.code,{children:"access_token"})," value."]}),"\n",(0,o.jsx)(n.li,{children:"Configure the recipient parameters in HertzBeat as follows."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"[Alert Notification] -> [Add Recipient] -> [Select Nailed Bot Notification Method] -> [Set Nailed Bot ACCESS_TOKEN] -> [OK]"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(75557).A+"",width:"3436",height:"890"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Configure the associated alert notification policy \u26a0\ufe0f [Add Notification Policy] -> [Associate the recipient you just set] -> [OK] !"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"Configure the alert notification policy to bind alert messages to recipients so that you can decide which alerts go to which person."}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"HertzBeat",src:t(88649).A+"",width:"3436",height:"1088"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"over-and-out-now-wait-for-the-alert-message-to-come-through-ding-ding-ding-ding",children:"Over and out, now wait for the alert message to come through. Ding, ding, ding, ding"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-text",children:"[HertzBeat Alert Notification]\nAlert target object : shenyu.process_open_fds.value\nTask ID : 205540620349696\nTask name : SHENYU_localhost\nAlarm level : Warning alarm\nAlarm Trigger Time : 2023-01-08 22:17:06\nDetails : Please note that the number of file descriptors opened by \u26a0\ufe0f ShenYu gateway is 3044 more than 3000\n"})}),"\n",(0,o.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["This hands-on article takes us through how to use HertzBeat to monitor Apache ShenYu metrics data, and we can find that HertzBeat, which combines ",(0,o.jsx)(n.code,{children:"Monitoring-Alert-Notification"}),", is much more convenient to operate and use, and you can include ShenYu in the monitoring by simply clicking on a page. There is no need to deploy multiple components and write multiple YML configuration files."]})}),"\n",(0,o.jsxs)(n.p,{children:["Apache ShenYu Github: ",(0,o.jsx)(n.a,{href:"https://github.com/apache/shenyu",children:"https://github.com/apache/shenyu"}),"\nHertzBeat Github: ",(0,o.jsx)(n.a,{href:"https://github.com/apache/hertzbeat",children:"https://github.com/apache/hertzbeat"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Welcome to learn about using Star Support Oh!"})}),"\n",(0,o.jsxs)(n.p,{children:["Experience heartbeat with a single docker command:\n",(0,o.jsx)(n.code,{children:"docker run -d -p 1157:1157 --name hertzbeat apache/hertzbeat"})]})]})}function d(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},75557(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/alert-notice-1-3bad6e06e2c870849bc656a2092d59ac.png"},88649(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/alert-notice-2-8025b90624873463fe0a3f75bd7efafa.png"},45212(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-1-9b12c5875c4c6bb3863f7e4efacb0ab6.png"},57742(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-3-f0835dba46e9e644bbad609fea757d2d.png"},75457(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-4-0300bcf78c5e2f606ab780bec8a31757.png"},54328(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-5-959d049b8246df725b9a7ebfb993ae71.png"},83(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-6-78533ff8941232b1be80110474edfe17.png"},61226(e,n,t){t.d(n,{A:()=>i});const i=t.p+"assets/images/monitor-shenyu-7-17d6e2393770eb0bfe6822e22c70d924.png"},60056(e,n,t){t.d(n,{R:()=>s,x:()=>a});var i=t(30758);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},88773(e){e.exports=JSON.parse('{"permalink":"/blog/2023/01/08/monitor-shenyu","editUrl":"https://github.com/apache/hertzbeat/edit/master/home/blog/2023-01-08-monitor-shenyu.md","source":"@site/blog/2023-01-08-monitor-shenyu.md","title":"HertzBeat\'s Monitoring Practice for API Gateway Apache ShenYu","description":"Monitoring practice for API gateway Apache ShenYu using HertzBeat, 5 minutes","date":"2023-01-08T00:00:00.000Z","tags":[{"inline":true,"label":"opensource","permalink":"/blog/tags/opensource"},{"inline":true,"label":"practice","permalink":"/blog/tags/practice"}],"readingTime":5.77,"hasTruncateMarker":false,"authors":[{"name":"tom","title":"tom","url":"https://github.com/tomsun28","key":null,"page":null}],"frontMatter":{"title":"HertzBeat\'s Monitoring Practice for API Gateway Apache ShenYu","author":"tom","author_title":"tom","author_url":"https://github.com/tomsun28","tags":["opensource","practice"]},"unlisted":false,"prevItem":{"title":"Monitoring Practices for DynamicTp Thread Pooling Framework with HertzBeat","permalink":"/blog/2023/02/02/monitor-dynamic-tp"},"nextItem":{"title":"Use HertzBeat Monitoring IoTDB","permalink":"/blog/2023/01/05/monitor-iotdb"}}')}}]);