"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[48300],{6153(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/alert-notice-2-8025b90624873463fe0a3f75bd7efafa.png"},8259(e,t,a){a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>m});var n=a(44320),i=(a(37953),a(58860));const o={title:"Use HertzBeat Monitoring IoTDB",author:"tom",author_title:"tom",author_url:"https://github.com/tomsun28",tags:["opensource","practice"]},r=void 0,l={permalink:"/blog/2023/01/05/monitor-iotdb",editUrl:"https://github.com/apache/hertzbeat/edit/master/home/blog/2023-01-05-monitor-iotdb.md",source:"@site/blog/2023-01-05-monitor-iotdb.md",title:"Use HertzBeat Monitoring IoTDB",description:"Use HertzBeat to monitor the Internet of Things database IoTDB, and it will be done in 5 minutes",date:"2023-01-05T00:00:00.000Z",formattedDate:"January 5, 2023",tags:[{label:"opensource",permalink:"/blog/tags/opensource"},{label:"practice",permalink:"/blog/tags/practice"}],readingTime:4.625,hasTruncateMarker:!1,authors:[{name:"tom",title:"tom",url:"https://github.com/tomsun28"}],frontMatter:{title:"Use HertzBeat Monitoring IoTDB",author:"tom",author_title:"tom",author_url:"https://github.com/tomsun28",tags:["opensource","practice"]},prevItem:{title:"HertzBeat's Monitoring Practice for API Gateway Apache ShenYu",permalink:"/blog/2023/01/08/monitor-shenyu"},nextItem:{title:"HertzBeat v1.2.3\uff01Support Prometheus,ShenYu and IotDb",permalink:"/blog/2022/12/28/hertzbeat-v1.2.3"}},s={authorsImageUrls:[void 0]},m=[{value:"Use HertzBeat to monitor the Internet of Things database IoTDB, and it will be done in 5 minutes",id:"use-hertzbeat-to-monitor-the-internet-of-things-database-iotdb-and-it-will-be-done-in-5-minutes",level:2},{value:"Introduction to IoTDB",id:"introduction-to-iotdb",level:3},{value:"Introduction to HertzBeat",id:"introduction-to-hertzbeat",level:3},{value:"Get monitoring IoTDB in HertzBeat in 5 minutes",id:"get-monitoring-iotdb-in-hertzbeat-in-5-minutes",level:3},{value:"Prerequisites, you already have IoTDB environment and HertzBeat environment",id:"prerequisites-you-already-have-iotdb-environment-and-hertzbeat-environment",level:4},{value:"1. Enable the <code>metrics</code> function on the IoTDB side, which will provide interface data in the form of prometheus metrics",id:"1-enable-the-metrics-function-on-the-iotdb-side-which-will-provide-interface-data-in-the-form-of-prometheus-metrics",level:4},{value:"2. Add IoTDB monitoring on the HertzBeat monitoring page",id:"2-add-iotdb-monitoring-on-the-hertzbeat-monitoring-page",level:4},{value:"3. Add IoTDB metric threshold alarm in HertzBeat system",id:"3-add-iotdb-metric-threshold-alarm-in-hertzbeat-system",level:4},{value:"Finished, now wait for the warning message to come. ding ding ding ding",id:"finished-now-wait-for-the-warning-message-to-come-ding-ding-ding-ding",level:3},{value:"Summary",id:"summary",level:2}],p={toc:m};function g({components:e,...t}){return(0,i.yg)("wrapper",(0,n.A)({},p,t,{components:e,mdxType:"MDXLayout"}),(0,i.yg)("h2",{id:"use-hertzbeat-to-monitor-the-internet-of-things-database-iotdb-and-it-will-be-done-in-5-minutes"},"Use HertzBeat to monitor the Internet of Things database IoTDB, and it will be done in 5 minutes"),(0,i.yg)("h3",{id:"introduction-to-iotdb"},"Introduction to IoTDB"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"Apache IoTDB (Internet of Things Database) is a time-series database management system that can provide users with data collection, storage and analysis services.\nDue to its lightweight architecture, high performance and high availability, and seamless integration with Hadoop and Spark ecosystems, IoTDB meets the requirements of massive data storage, high-throughput data writing, and complex data query and analysis in the industrial IoT field. need.")),(0,i.yg)("h3",{id:"introduction-to-hertzbeat"},"Introduction to HertzBeat"),(0,i.yg)("blockquote",null,(0,i.yg)("p",{parentName:"blockquote"},"HertzBeat is an open source, easy-to-use and friendly real-time monitoring tool that does not require Agent and has powerful custom monitoring capabilities.\nSupports monitoring of application services, databases, operating systems, middleware, cloud native, etc., threshold alarms, and alarm notifications (email WeChat Dingding Feishu).\nHertzBeat's powerful customization, multi-type support, easy expansion, and low coupling hope to help developers and small and medium teams quickly build their own monitoring tools.")),(0,i.yg)("h3",{id:"get-monitoring-iotdb-in-hertzbeat-in-5-minutes"},"Get monitoring IoTDB in HertzBeat in 5 minutes"),(0,i.yg)("h4",{id:"prerequisites-you-already-have-iotdb-environment-and-hertzbeat-environment"},"Prerequisites, you already have IoTDB environment and HertzBeat environment"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"IoTDB ",(0,i.yg)("a",{parentName:"li",href:"https://iotdb.apache.org/UserGuide/V0.13.x/QuickStart/QuickStart.html"},"deployment and installation documentation")),(0,i.yg)("li",{parentName:"ul"},"HertzBeat ",(0,i.yg)("a",{parentName:"li",href:"https://hertzbeat.apache.org/docs/start/docker-deploy"},"deployment installation documentation"))),(0,i.yg)("h4",{id:"1-enable-the-metrics-function-on-the-iotdb-side-which-will-provide-interface-data-in-the-form-of-prometheus-metrics"},"1. Enable the ",(0,i.yg)("inlineCode",{parentName:"h4"},"metrics")," function on the IoTDB side, which will provide interface data in the form of prometheus metrics"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"The metric collection is disabled by default, you need to modify the parameters in ",(0,i.yg)("inlineCode",{parentName:"p"},"conf/iotdb-metric.yml")," first, then restart the server"),(0,i.yg)("pre",{parentName:"li"},(0,i.yg)("code",{parentName:"pre",className:"language-yaml"},"# Whether to start the monitoring module, the default is false\nenableMetric: true\n\n# Data provision method, externally provide metrics data through jmx and prometheus protocol, optional parameters: [JMX, PROMETHEUS, IOTDB], IOTDB is closed by default.\nmetricReporterList:\n   - JMX\n   - PROMETHEUS\n"))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Restart IoTDB, open a browser or use curl to access ",(0,i.yg)("a",{parentName:"p",href:"http://ip:9091/metrics"},"http://ip:9091/metrics"),", and you can see the metric data."))),(0,i.yg)("h4",{id:"2-add-iotdb-monitoring-on-the-hertzbeat-monitoring-page"},"2. Add IoTDB monitoring on the HertzBeat monitoring page"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Click Add IoTDB Monitoring"),(0,i.yg)("p",{parentName:"li"},"Path: Menu -> Database Monitoring -> IoTDB Monitoring -> Add IoTDB Monitoring"),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(76802).A,width:"4064",height:"2166"}))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Configure the parameters required for monitoring IoTDB"),(0,i.yg)("p",{parentName:"li"},"Fill in the IoTDB ",(0,i.yg)("strong",{parentName:"p"},"service IP")," and ",(0,i.yg)("strong",{parentName:"p"},"monitoring port")," (default 9091) on the monitoring page, and finally click OK to add.\nFor other parameters such as ",(0,i.yg)("strong",{parentName:"p"},"collection interval"),", ",(0,i.yg)("strong",{parentName:"p"},"timeout period"),", etc., please refer to ",(0,i.yg)("a",{parentName:"p",href:"https://hertzbeat.apache.org/docs/help/iotdb/"},"Help Documentation")," ",(0,i.yg)("a",{parentName:"p",href:"https://hertzbeat.apache.org/docs/help"},"https://hertzbeat.apache.org/docs/help")," /iotdb/"),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(32889).A,width:"4064",height:"2166"}))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Complete \u2705, now we have added the monitoring of IoTDB, check the monitoring list to see our added items."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(26640).A,width:"4064",height:"2166"}))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Click ",(0,i.yg)("strong",{parentName:"p"},"Operation"),"->",(0,i.yg)("strong",{parentName:"p"},"Monitoring Details Icon")," of the monitoring list item to browse the real-time monitoring metric data of IoTDB."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(38863).A,width:"4064",height:"2166"}))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Click ",(0,i.yg)("strong",{parentName:"p"},"Monitoring History Details TAB")," to browse IoTDB's historical monitoring metric data chart\ud83d\udcc8."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(99846).A,width:"4064",height:"2166"})))),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Complete DONE! Through the above steps, it is actually two steps to sum up")),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Enable ",(0,i.yg)("inlineCode",{parentName:"strong"},"metrics")," function on IoTDB in one step")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("strong",{parentName:"li"},"Another step is to configure the IP port on the HertzBeat monitoring page to add monitoring"))),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"In this way, we have completed the monitoring of IoTDB. We can view the monitoring details and metrics at any time to observe its service status, but people cannot always watch it. When there is always a time to rest, monitoring is often accompanied by alarms. When monitoring When the metrics are abnormal, the monitoring tool needs to be able to notify the person in charge in time")),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Next, we will teach you step by step to configure the threshold alarm notification in the HertzBeat system")),(0,i.yg)("h4",{id:"3-add-iotdb-metric-threshold-alarm-in-hertzbeat-system"},"3. Add IoTDB metric threshold alarm in HertzBeat system"),(0,i.yg)("ol",null,(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Configure a threshold alarm for an important metric"),(0,i.yg)("p",{parentName:"li"}," Path: Menu -> Alarm Threshold -> Add Threshold"),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Select the configured metric object. IotDB monitors many metrics, one of which is related to the status of the node ",(0,i.yg)("inlineCode",{parentName:"p"},"cluster_node_status")," -> ",(0,i.yg)("inlineCode",{parentName:"p"},"status")," (node status, 1=online 2=offline).")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Here we configure to send an alarm when the metric ",(0,i.yg)("inlineCode",{parentName:"p"},"status==2"),", the alarm level is ",(0,i.yg)("strong",{parentName:"p"},"Critical Alarm"),", which is triggered once, as shown in the figure below."),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(81053).A,width:"4064",height:"2166"}))))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Add message notification recipients"),(0,i.yg)("p",{parentName:"li"}," Path: Menu -> Alarm Notification -> Alarm Recipient -> Add New Recipient"),(0,i.yg)("p",{parentName:"li"}," Message notification methods support ",(0,i.yg)("strong",{parentName:"p"},"email, DingTalk, WeChat Work, Feishu, WebHook, SMS"),", etc. Here we take the commonly used DingTalk as an example."),(0,i.yg)("ul",{parentName:"li"},(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Refer to this ",(0,i.yg)("a",{parentName:"p",href:"https://hertzbeat.apache.org/docs/help/alert_dingtalk"},"Help Documentation")," ",(0,i.yg)("a",{parentName:"p",href:"https://hertzbeat.apache.org/docs/help/alert_dingtalk"},"https://hertzbeat.apache.org/docs/help/alert_dingtalk")," to configure the robot on DingTalk and set the security custom keyword ",(0,i.yg)("inlineCode",{parentName:"p"},"HertzBeat"),", get the corresponding ",(0,i.yg)("inlineCode",{parentName:"p"},"access_token")," value.")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("p",{parentName:"li"},"Configure the receiver parameters in HertzBeat as follows."),(0,i.yg)("p",{parentName:"li"},"\u3010Alarm Notification\u3011->\u3010New Recipient\u3011->\u3010Select DingTalk Robot Notification Method\u3011->\u3010Set DingTalk Robot ACCESS_TOKEN\u3011->\u3010OK\u3011"),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(57362).A,width:"3436",height:"890"}))))),(0,i.yg)("li",{parentName:"ol"},(0,i.yg)("p",{parentName:"li"},"Configure the associated alarm notification strategy \u26a0\ufe0f ","[Add notification strategy]"," -> ","[Associate the recipient just set]"," -> ","[OK]"),(0,i.yg)("p",{parentName:"li"},(0,i.yg)("img",{alt:"HertzBeat",src:a(6153).A,width:"3436",height:"1088"})))),(0,i.yg)("h3",{id:"finished-now-wait-for-the-warning-message-to-come-ding-ding-ding-ding"},"Finished, now wait for the warning message to come. ding ding ding ding"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-text"},"[HertzBeat warning notification]\nAlarm target object: iotdb.cluster_node_status.status\nAffiliated monitoring ID: 205540620349696\nBelonging monitoring name: IOTDB_localhost\nAlarm level: critical alarm\nAlarm trigger time: 2023-01-05 22:17:06\nContent details: The status of IOTDB node 127.0.0.1 is monitored as OFFLINE, please deal with it in time.\n")),(0,i.yg)("h2",{id:"summary"},"Summary"),(0,i.yg)("p",null,"This practical article took us to experience that if HertzBeat is used to monitor the IoTDB database metric data, we can find that HertzBeat, which integrates monitoring-alarm-notification, is more convenient in operation and use, and IoTDB can be included in the monitoring with a simple click on the page, it is no longer necessary to deploy multiple components and write multiple YML configuration files with thresholds."),(0,i.yg)("p",null,"IoTDB Github: ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/iotdb"},"https://github.com/apache/iotdb"),"\nHertzBeat Github: ",(0,i.yg)("a",{parentName:"p",href:"https://github.com/apache/hertzbeat"},"https://github.com/apache/hertzbeat")),(0,i.yg)("p",null,(0,i.yg)("strong",{parentName:"p"},"Welcome to learn about using Star Support!")),(0,i.yg)("p",null,"Only one docker command is needed to install and experience heartbeat:\n",(0,i.yg)("inlineCode",{parentName:"p"},"docker run -d -p 1157:1157 --name hertzbeat apache/hertzbeat")),(0,i.yg)("p",null,"Note \u26a0\ufe0fHertzBeat v1.2.3 version supports IoTDB v0.12 v0.13. Since its v1.0 has just been released, all metrics of this version are not yet compatible."))}g.isMDXComponent=!0},26640(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-3-83c02b3121bbcac706c039c964eb3086.png"},32889(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-2-243561382bbdf6fec6bd9133bdc510a3.png"},38863(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-4-20ca3228c2ff616977e1b266617fc33e.png"},57362(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/alert-notice-1-3bad6e06e2c870849bc656a2092d59ac.png"},58860(e,t,a){a.d(t,{xA:()=>p,yg:()=>c});var n=a(37953);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach(function(t){i(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),m=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=m(e.components);return n.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef(function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=m(a),c=i,h=d["".concat(s,".").concat(c)]||d[c]||g[c]||o;return a?n.createElement(h,r(r({ref:t},p),{},{components:a})):n.createElement(h,r({ref:t},p))});function c(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var m=2;m<o;m++)r[m]=a[m];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},76802(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-1-518ff666fb4994d0961f999e4185600f.png"},81053(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-6-8050c598b8bac37904e0f0b63d309f95.png"},99846(e,t,a){a.d(t,{A:()=>n});const n=a.p+"assets/images/monitor-iotdb-5-eedef9c331cdd660090a0d078c851a83.png"}}]);