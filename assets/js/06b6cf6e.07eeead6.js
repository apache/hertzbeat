"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[44901],{92831(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"help/consul_sd","title":"Monitoring Consul Service Discovery","description":"HertzBeat integrates with Consul registry to automatically discover service instances and create monitoring tasks for them.","source":"@site/versioned_docs/version-1.7.x/help/consul_sd.md","sourceDirName":"help","slug":"/help/consul_sd","permalink":"/docs/1.7.x/help/consul_sd","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-1.7.x/help/consul_sd.md","tags":[],"version":"1.7.x","frontMatter":{"id":"consul_sd","title":"Monitoring Consul Service Discovery","sidebar_label":"Consul Service Discovery","keywords":["open source monitoring tool","open source service discovery monitoring tool","monitoring Consul service discovery"]},"sidebar":"docs","previous":{"title":"Nacos Service Discovery","permalink":"/docs/1.7.x/help/nacos_sd"},"next":{"title":"Zookeeper Service Discovery","permalink":"/docs/1.7.x/help/zookeeper_sd"}}');var r=s(86070),t=s(60056);const o={id:"consul_sd",title:"Monitoring Consul Service Discovery",sidebar_label:"Consul Service Discovery",keywords:["open source monitoring tool","open source service discovery monitoring tool","monitoring Consul service discovery"]},l=void 0,c={},d=[{value:"Overview",id:"overview",level:3},{value:"PreRequisites",id:"prerequisites",level:3},{value:"Deploy Consul Server",id:"deploy-consul-server",level:4},{value:"Configuration parameter",id:"configuration-parameter",level:3},{value:"Usage Steps",id:"usage-steps",level:3},{value:"Example of usage",id:"example-of-usage",level:3},{value:"Notes",id:"notes",level:3},{value:"Collection Metric",id:"collection-metric",level:3},{value:"Metric set: Monitor Target",id:"metric-set-monitor-target",level:4},{value:"Use Cases",id:"use-cases",level:3},{value:"Integration with Consul Features",id:"integration-with-consul-features",level:3}];function a(e){const n={a:"a",blockquote:"blockquote",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"HertzBeat integrates with Consul registry to automatically discover service instances and create monitoring tasks for them."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Consul Service Discovery allows HertzBeat to connect to your Consul server and automatically discover all registered service instances. When a new service instance is registered or an existing instance goes offline, HertzBeat will automatically create or delete corresponding monitoring tasks, achieving automated monitoring in microservice environments."}),"\n",(0,r.jsx)(n.h3,{id:"prerequisites",children:"PreRequisites"}),"\n",(0,r.jsx)(n.h4,{id:"deploy-consul-server",children:"Deploy Consul Server"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Deploy Consul server according to ",(0,r.jsx)(n.a,{href:"https://developer.hashicorp.com/consul/docs/fundamentals/install",children:"Consul official documentation"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"Ensure Consul server is accessible from HertzBeat."}),"\n",(0,r.jsxs)(n.li,{children:["Verify that you can access Consul UI at ",(0,r.jsx)(n.code,{children:"http://your-consul-server:8500/ui/"})]}),"\n",(0,r.jsx)(n.li,{children:"Ensure the Consul HTTP API is accessible (default port: 8500)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configuration-parameter",children:"Configuration parameter"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Parameter name"}),(0,r.jsx)(n.th,{children:"Parameter help description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Target Name"}),(0,r.jsx)(n.td,{children:"Identify the name of this monitoring. The name needs to be unique."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Consul Host"}),(0,r.jsxs)(n.td,{children:["Consul server IP address or domain name. Note\u26a0\ufe0fWithout protocol header (eg: https://, http://). Example: ",(0,r.jsx)(n.code,{children:"consul-server"})," or ",(0,r.jsx)(n.code,{children:"192.168.1.100"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Consul Port"}),(0,r.jsx)(n.td,{children:"Port provided by the Consul server. The default is 8500"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Collection interval"}),(0,r.jsx)(n.td,{children:"Interval time of monitor periodic data collection, unit: second, and the minimum interval that can be set is 30 seconds."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Description remarks"}),(0,r.jsx)(n.td,{children:"For more information about identifying and describing this monitoring, users can note information here."})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"usage-steps",children:"Usage Steps"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Create Service Discovery Monitoring"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In HertzBeat web UI, navigate to ",(0,r.jsx)(n.strong,{children:"Monitoring"})," \u2192 ",(0,r.jsx)(n.strong,{children:"New Monitoring"})]}),"\n",(0,r.jsxs)(n.li,{children:["Select monitoring type: ",(0,r.jsx)(n.strong,{children:"Consul Service Discovery"})]}),"\n",(0,r.jsx)(n.li,{children:"Fill in the basic configuration parameters"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configure Monitoring Template"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"After creating the service discovery monitoring, you need to specify a monitoring template"}),"\n",(0,r.jsx)(n.li,{children:"The template defines what type of monitoring to create for discovered service instances"}),"\n",(0,r.jsx)(n.li,{children:"For example: If discovered instances are HTTP services, you can select HTTP monitoring template"}),"\n",(0,r.jsx)(n.li,{children:"Common template types: Port, HTTP, HTTPS, Ping, etc."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Automatic Discovery"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HertzBeat will periodically query Consul server based on the collection interval"}),"\n",(0,r.jsx)(n.li,{children:"Automatically create monitoring tasks for newly registered service instances"}),"\n",(0,r.jsx)(n.li,{children:"Automatically delete monitoring tasks for offline service instances"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"View Discovered Instances"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"In the monitoring list, you can see all automatically created sub-monitoring tasks"}),"\n",(0,r.jsx)(n.li,{children:"Each sub-monitoring task corresponds to a discovered service instance"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"example-of-usage",children:"Example of usage"}),"\n",(0,r.jsxs)(n.p,{children:["Suppose your Consul server is running at ",(0,r.jsx)(n.code,{children:"192.168.1.100:8500"}),", and you want to automatically monitor all service instances registered in it."]}),"\n",(0,r.jsx)(n.p,{children:"Configuration example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Target Name"}),": ",(0,r.jsx)(n.code,{children:"Consul-Service-Discovery"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consul Host"}),": ",(0,r.jsx)(n.code,{children:"192.168.1.100"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consul Port"}),": ",(0,r.jsx)(n.code,{children:"8500"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Collection interval"}),": ",(0,r.jsx)(n.code,{children:"60"})," seconds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring Template"}),": Select ",(0,r.jsx)(n.code,{children:"Port"})," monitoring (to detect instance availability)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"After configuration:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"HertzBeat connects to Consul server via HTTP API"}),"\n",(0,r.jsx)(n.li,{children:"Retrieves all registered service instances"}),"\n",(0,r.jsxs)(n.li,{children:["Automatically creates Port monitoring for each instance (e.g., ",(0,r.jsx)(n.code,{children:"api-service-192.168.1.101:8080"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Every 60 seconds, checks for newly registered or offline services and updates monitoring tasks accordingly"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Network Connectivity"}),": Ensure HertzBeat can access the Consul server address and port (default: 8500)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitoring Templates"}),": Service discovery only discovers service instance addresses, you need to configure appropriate monitoring templates to actually monitor the instances"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Collection Interval"}),": Recommended minimum interval is 60 seconds to avoid excessive requests to Consul server"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"ACL Token"}),": If Consul is configured with ACL (Access Control List), you may need to configure the appropriate token"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Health"}),": Consul service discovery will discover both healthy and unhealthy instances"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Datacenter"}),": By default, discovers services in the local datacenter. If you need to discover services in a specific datacenter, additional configuration may be required"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Instance Naming"}),": Automatically created monitoring tasks are named in the format: ",(0,r.jsx)(n.code,{children:"{ServiceName}-{Host}:{Port}"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"collection-metric",children:"Collection Metric"}),"\n",(0,r.jsx)(n.h4,{id:"metric-set-monitor-target",children:"Metric set: Monitor Target"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Metric name"}),(0,r.jsx)(n.th,{children:"Metric unit"}),(0,r.jsx)(n.th,{children:"Metric help description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"target"}),(0,r.jsx)(n.td,{children:"none"}),(0,r.jsx)(n.td,{children:"Discovered service instance target"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"host"}),(0,r.jsx)(n.td,{children:"none"}),(0,r.jsx)(n.td,{children:"Service instance host address"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"port"}),(0,r.jsx)(n.td,{children:"none"}),(0,r.jsx)(n.td,{children:"Service instance port number"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"use-cases",children:"Use Cases"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Microservice Architecture"}),": Automatically monitor all microservice instances registered in Consul"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Mesh"}),": Monitor services using Consul Connect service mesh"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Multi-Datacenter"}),": Monitor service instances across multiple Consul datacenters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Dynamic Scaling"}),": Automatically adapt to service instances added/removed due to autoscaling"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Health Check"}),": Combine with Consul's health check mechanism to monitor service health status"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Governance"}),": Centrally manage monitoring of all services in the Consul service ecosystem"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"integration-with-consul-features",children:"Integration with Consul Features"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Health"}),": Consul service discovery can leverage Consul's health check information"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Tags"}),": Service instances discovered from Consul may include tag information"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"KV Storage"}),": Can be used in conjunction with Consul KV storage to achieve more flexible service discovery"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service Mesh"}),": Supports service discovery in Consul Connect service mesh environment"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},60056(e,n,s){s.d(n,{R:()=>o,x:()=>l});var i=s(30758);const r={},t=i.createContext(r);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);