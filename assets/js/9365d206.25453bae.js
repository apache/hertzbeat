"use strict";(globalThis.webpackChunkhertzbeat=globalThis.webpackChunkhertzbeat||[]).push([[39492],{38679(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>m,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"advanced/extend-ngql","title":"NGQL Custom Monitoring","description":"From Custom Monitoring, you are familiar with how to customize types, Metrics, protocols, etc. Here we will introduce in detail how to use JDBC(support mysql,mariadb,postgresql,sqlserver at present) to customize Metric monitoring.","source":"@site/versioned_docs/version-1.6.x/advanced/extend-ngql.md","sourceDirName":"advanced","slug":"/advanced/extend-ngql","permalink":"/docs/1.6.x/advanced/extend-ngql","draft":false,"unlisted":false,"editUrl":"https://github.com/apache/hertzbeat/edit/master/home/versioned_docs/version-1.6.x/advanced/extend-ngql.md","tags":[],"version":"1.6.x","frontMatter":{"id":"extend-ngql","title":"NGQL Custom Monitoring","sidebar_label":"NGQL Custom Monitoring"},"sidebar":"docs","previous":{"title":"SNMP Protocol Custom Monitoring","permalink":"/docs/1.6.x/advanced/extend-snmp"},"next":{"title":"Monitoring Template","permalink":"/docs/1.6.x/template"}}');var r=t(86070),i=t(60056);const o={id:"extend-ngql",title:"NGQL Custom Monitoring",sidebar_label:"NGQL Custom Monitoring"},a=void 0,l={},d=[{value:"Data Parsing Methods",id:"data-parsing-methods",level:3},{value:"<strong>filterCount</strong>",id:"filtercount",level:4},{value:"<strong>oneRow</strong>",id:"onerow",level:4},{value:"<strong>multiRow</strong>",id:"multirow",level:4},{value:"<strong>columns</strong>",id:"columns",level:4},{value:"Customization Steps",id:"customization-steps",level:3},{value:"Monitoring Template YML",id:"monitoring-template-yml",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",h3:"h3",h4:"h4",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["From ",(0,r.jsx)(n.a,{href:"extend-point",children:"Custom Monitoring"}),", you are familiar with how to customize types, Metrics, protocols, etc. Here we will introduce in detail how to use JDBC(support mysql,mariadb,postgresql,sqlserver at present) to customize Metric monitoring.\nNGQL custom monitoring allows us to easily query metric data from the NebulaGraph graph database using NGQL or OpenCypher, supporting NebulaGraph 3.X versions."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"data-parsing-methods",children:"Data Parsing Methods"}),"\n",(0,r.jsx)(n.p,{children:"Mapping the fields returned by NGQL queries to the metrics we need allows us to obtain corresponding metric data. Currently, there are four mapping and parsing methods: filterCount, oneRow, multiRow, columns."}),"\n",(0,r.jsx)(n.h4,{id:"filtercount",children:(0,r.jsx)(n.strong,{children:"filterCount"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Counts the number of results returned by a query based on specified fields, usually used in ",(0,r.jsx)(n.code,{children:"SHOW ..."})," statements. If NGQL statements can directly return the count, it is recommended to use NGQL statements for counting.",(0,r.jsx)(n.br,{}),"\n","Syntax for the ",(0,r.jsx)(n.code,{children:"commands"})," field: aliasField#NGQL#filterName#filterValue",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"aliasField"}),": corresponds to the value in the ",(0,r.jsx)(n.code,{children:"aliasFields"})," in the monitoring template",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"NGQL"}),": query statement",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"filterName"}),": filter attribute name (optional)",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"filterValue"}),": filter attribute value (optional)"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["online_meta_count#SHOW HOSTS META#Status#ONLINE",(0,r.jsx)(n.br,{}),"\n","Counts the number of rows returned by ",(0,r.jsx)(n.code,{children:"SHOW HOSTS META"})," where Status equals ONLINE."]}),"\n",(0,r.jsxs)(n.li,{children:["online_meta_count#SHOW HOSTS META##",(0,r.jsx)(n.br,{}),"\n","Counts the number of rows returned by ",(0,r.jsx)(n.code,{children:"SHOW HOSTS META"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"onerow",children:(0,r.jsx)(n.strong,{children:"oneRow"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Queries a single row of data by mapping the column names of the query result set to the queried fields."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Metrics fields: a, b"}),"\n",(0,r.jsxs)(n.li,{children:["NGQL query: match (v",":metrics",") return v.metrics.a as a, v.metrics.b as b;"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Here, the metric fields can be mapped to the response data row by row."}),"\n",(0,r.jsx)(n.p,{children:"Notes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When using the ",(0,r.jsx)(n.code,{children:"oneRow"})," method, if a single query statement returns multiple rows of results, only the first row of results will be mapped to the metric fields."]}),"\n",(0,r.jsxs)(n.li,{children:["When the ",(0,r.jsx)(n.code,{children:"commands"})," field contains two or more query statements and the returned fields of multiple query statements are the same, the fields returned by the subsequent statement will overwrite those returned by the previous statement."]}),"\n",(0,r.jsxs)(n.li,{children:["It is recommended to use the limit statement to limit the number of rows returned in the result set when defining ",(0,r.jsx)(n.code,{children:"commands"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"multirow",children:(0,r.jsx)(n.strong,{children:"multiRow"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Queries multiple rows of data by mapping the column names of the query result set to the queried fields."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"For example:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Metrics fields: a, b"}),"\n",(0,r.jsxs)(n.li,{children:["NGQL query: match (v",":metrics",") return v.metrics.a as a, v.metrics.b as b;"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Here, the metric fields can be mapped to the response data row by row.\nNotes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When using the ",(0,r.jsx)(n.code,{children:"multiRow"})," method, the ",(0,r.jsx)(n.code,{children:"commands"})," field can only contain one query statement."]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"columns",children:(0,r.jsx)(n.strong,{children:"columns"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Collects a single row of metric data by mapping two columns of data (key-value), where the key matches the queried fields and the value is the value of the queried field."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Notes:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["When using the ",(0,r.jsx)(n.code,{children:"columns"})," method, the first two columns of the result set are mapped to collect data by default, where the first column corresponds to the metric name and the second column corresponds to the metric value."]}),"\n",(0,r.jsxs)(n.li,{children:["When the ",(0,r.jsx)(n.code,{children:"commands"})," field contains two or more query statements and the first column of data returned by multiple query statements is duplicated, the result of the last statement will be retained."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"customization-steps",children:"Customization Steps"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"HertzBeat Page"})," -> ",(0,r.jsx)(n.strong,{children:"Monitoring Template Menu"})," -> ",(0,r.jsx)(n.strong,{children:"Add Monitoring Type"})," -> ",(0,r.jsx)(n.strong,{children:"Configure Custom Monitoring Template YML"})," -> ",(0,r.jsx)(n.strong,{children:"Click Save Application"})," -> ",(0,r.jsx)(n.strong,{children:"Use the New Monitoring Type to Add Monitoring"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"HertzBeat Page",src:t(87392).A+"",width:"4064",height:"2166"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:"Configuration usages of the monitoring templates yml are detailed below."}),"\n",(0,r.jsx)(n.h3,{id:"monitoring-template-yml",children:"Monitoring Template YML"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["We define all monitoring collection types (mysql,jvm,k8s) as yml monitoring templates, and users can import these templates to support corresponding types of monitoring.",(0,r.jsx)(n.br,{}),"\n","Monitoring template is used to define the name of monitoring type(international), request parameter mapping, index information, collection protocol configuration information, etc."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"eg: Customize a monitoring type named example_ngql, which collects metric data using NGQL."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Monitoring category: service-application service program-application program db-database custom-custom os-operating system bigdata-big data mid-middleware webserver-web server cache-cache cn-cloud native network-network monitoring, etc.\ncategory: db\n# Monitoring application type (consistent with the file name) eg: linux windows tomcat mysql aws...\napp: example_ngql\nname:\n  zh-CN: NGQL Custom Monitoring Application\n  en-US: NGQL Custom APP\n# Monitoring parameter definition. These are input parameter variables, which can be written in the format of ^_^host^_^ to be replaced by system variable values in the later configuration\n# This part is usually not modified\nparams:\n  # field-param field key\n  - field: host\n    name:\n      zh-CN: Target Host\n      en-US: Target Host\n    type: host\n    required: true\n  - field: graphPort\n    name:\n      zh-CN: Graph Port\n      en-US: Graph Port\n    type: number\n    range: '[0,65535]'\n    required: true\n    defaultValue: 9669\n  - field: username\n    name:\n      zh-CN: Username\n      en-US: Username\n    type: text\n    required: true\n  - field: password\n    name:\n      zh-CN: Password\n      en-US: Password\n    type: password\n    required: true\n  - field: spaceName\n    name:\n      zh-CN: Space Name\n      en-US: Space Name\n    type: text\n    required: false\n  - field: timeout\n    name:\n      zh-CN: Connect Timeout(ms)\n      en-US: Connect Timeout(ms)\n    type: number\n    unit: ms\n    range: '[0,100000]'\n    required: true\n    defaultValue: 6000\n# Metric collection configuration list\nmetrics:\n  - name: base_info\n    i18n:\n      zh-CN: Vertex statistics\n      en-US: Vertex statistics\n    priority: 0\n    fields:\n      - field: tag1\n        type: 1\n        i18n:\n          zh-CN: tag1\n          en-US: tag1\n      - field: tag1\n        type: 1\n        i18n:\n          zh-CN: tag2\n          en-US: tag2\n    aliasFields:\n      - tag1\n      - tag2\n    protocol: ngql\n    ngql:\n      host: ^_^host^_^\n      username: ^_^username^_^\n      password: ^_^password^_^\n      port: ^_^graphPort^_^\n      spaceName: ^_^spaceName^_^\n      parseType: columns\n      # Define the query statements used to collect data\n      commands:\n        - match (v:tag1) return \"tag1\" as name ,count(v) as cnt \n        - match (v:tag2) return \"tag2\" as name ,count(v) as cnt\n      timeout: ^_^timeout^_^\n"})})]})}function m(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},87392(e,n,t){t.d(n,{A:()=>s});const s=t.p+"assets/images/extend-point-1-0175fbb6d4bd1105c2596f7ccae83938.png"},60056(e,n,t){t.d(n,{R:()=>o,x:()=>a});var s=t(30758);const r={},i=s.createContext(r);function o(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);