# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: daily_inspection
description: "Execute daily health inspection on all monitors and generate a comprehensive report"
version: "1.0"

# Output configuration
output:
  type: report           # report / simple / data / action
  format: markdown       # markdown / json / text
  # language is not specified here - uses system default locale from user's SystemConfig
  contentStep: generate_report  # Which step's output is the main content

parameters:
  - name: includeMetrics
    type: boolean
    description: "Whether to include metrics data in the report"
    required: false
    defaultValue: "false"

steps:
  - id: get_monitor_summary
    type: tool
    tool: query_monitors
    args:
      status: 9
      pageSize: 100
      pageIndex: 0
      sort: "gmtCreate"
      order: "desc"
      includeStats: true

  # TODO: Enable when alert tables are initialized
  # - id: get_alert_summary
  #   type: tool
  #   tool: getAlertsSummary

  # - id: get_firing_alerts
  #   type: tool
  #   tool: queryAlerts
  #   args:
  #     status: "firing"
  #     pageSize: 20
  #     pageIndex: 0
  #     sort: "startAt"
  #     order: "desc"

  - id: get_storage_status
    type: tool
    tool: get_warehouse_status

  - id: generate_report
    type: llm
    prompt: |
      You are an expert IT operations engineer. Based on the following monitoring data, generate a concise daily inspection report.
      
      ## Monitor Status Summary
      ${get_monitor_summary}
      
      ## Storage Status
      ${get_storage_status}
      
      Please provide a report with:
      1. Overall Health Summary
      2. Critical Issues Requiring Immediate Attention  
      3. Recommendations
      
      Format the report in markdown. Be concise but thorough.
